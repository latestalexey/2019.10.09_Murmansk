
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Номенклатура.Ссылка КАК Номенклатура,
		|	ВЫБОР
		|		КОГДА Номенклатура.ЭтоГруппа
		|			ТОГДА """"
		|		ИНАЧЕ ЕСТЬNULL(Номенклатура.ЕдиницаХраненияОстатков.Наименование, ВЫБОР
		|					КОГДА ЕСТЬNULL(Номенклатура.Весовой, ЛОЖЬ)
		|						ТОГДА ""кг""
		|					ИНАЧЕ ""шт""
		|				КОНЕЦ)
		|	КОНЕЦ КАК ЕдиницаИзмерения,
		|	ЕСТЬNULL(Номенклатура.ЕдиницаХраненияОстатков, ЗНАЧЕНИЕ(Справочник.ЕдиницыИзмерения.ПустаяСсылка)) КАК ЕдиницаИзмеренияСсылка,
		|	ЕСТЬNULL(Номенклатура.Артикул, """") КАК Артикул,
		|	ЕСТЬNULL(Номенклатура.Весовой, ЛОЖЬ) КАК Весовой,
		|	Номенклатура.Код КАК Код,
		|	Номенклатура.Наименование КАК Наименование,
		|	Номенклатура.ЭтоГруппа КАК ЭтоГруппа,
		|	ЕСТЬNULL(Номенклатура.ВестиУчетПоСериям, ЛОЖЬ) КАК ЕстьСерии,
		|	ВЫБОР
		|		КОГДА &ИспользоватьХарактеристикиНоменклатуры
		|			ТОГДА ЕСТЬNULL(Номенклатура.ВестиУчетПоХарактеристикам, ЛОЖЬ)
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ЕстьХарактеристики,
		|	ЕСТЬNULL(Номенклатура.ВестиСерийныеНомера, ЛОЖЬ) КАК ЕстьСН
		|ПОМЕСТИТЬ ВТНоменклатура
		|ИЗ
		|	Справочник.Номенклатура КАК Номенклатура
		|ГДЕ
		|	ВЫБОР
		|			КОГДА &РежимЗапроса = ""ПоискПоНоменклатуре""
		|					ИЛИ &РежимЗапроса = ""ПоискПоНоменклатуреУпаковке""
		|					ИЛИ &РежимЗапроса = ""ПоискПоМассивамНоменклатурыУпаковки""
		|				ТОГДА НЕ Номенклатура.ЭтоГруппа
		|						И Номенклатура.Ссылка В (&ПараметрНоменклатуры)
		|			КОГДА &РежимЗапроса = ""ПоискПоАртикулуКодуШК""
		|				ТОГДА НЕ Номенклатура.ЭтоГруппа
		|						И ВЫБОР
		|							КОГДА &ЭтоВесовойТовар
		|								ТОГДА Номенклатура.Ссылка В
		|										(ВЫБРАТЬ
		|											КодыВесовогоТовара.Номенклатура
		|										ИЗ
		|											РегистрСведений.КодыВесовогоТовара КАК КодыВесовогоТовара
		|										ГДЕ
		|											КодыВесовогоТовара.Код = &ЧислоПоиска)
		|							ИНАЧЕ Номенклатура.Код ПОДОБНО &СтрокаПоиска
		|									ИЛИ Номенклатура.Артикул ПОДОБНО &СтрокаПоиска
		|									ИЛИ Номенклатура.Ссылка В
		|										(ВЫБРАТЬ
		|											Штрихкоды.Владелец
		|										ИЗ
		|											РегистрСведений.Штрихкоды КАК Штрихкоды
		|										ГДЕ
		|											Штрихкоды.Штрихкод = &СтрокаПоиска)
		|						КОНЕЦ
		|			КОГДА &РежимЗапроса = ""СписокУпаковокДляНоменклатуры""
		|				ТОГДА Номенклатура.Ссылка В (&ПараметрНоменклатуры)
		|			КОГДА &РежимЗапроса = ""СписокНоменклатурыДляГрупп""
		|				ТОГДА Номенклатура.Родитель В (&ПараметрНоменклатуры)
		|			КОГДА &РежимЗапроса = ""ПоискПоЧастиНаименования""
		|				ТОГДА НЕ Номенклатура.ЭтоГруппа
		|						И (Номенклатура.Код ПОДОБНО &СтрокаПоиска
		|							ИЛИ Номенклатура.Артикул ПОДОБНО &СтрокаПоиска
		|							ИЛИ Номенклатура.Наименование ПОДОБНО &СтрокаПоиска)
		|			ИНАЧЕ НЕ Номенклатура.ЭтоГруппа
		|		КОНЕЦ
		|	И НЕ Номенклатура.ПометкаУдаления
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Номенклатура
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВложенныйЗапрос.Штрихкод КАК Штрихкод,
		|	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
		|	ВложенныйЗапрос.Характеристика КАК Характеристика,
		|	ВложенныйЗапрос.Серия КАК Серия,
		|	ВложенныйЗапрос.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
		|	ВложенныйЗапрос.Коэффициент КАК Коэффициент,
		|	ВложенныйЗапрос.ЕдиницаИзмеренияСсылка КАК ЕдиницаИзмеренияСсылка,
		|	ВложенныйЗапрос.ИмяХарактеристики КАК ИмяХарактеристики,
		|	ВложенныйЗапрос.ИмяСерии КАК ИмяСерии
		|ПОМЕСТИТЬ ВТУпаковки
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДополнительныеУпаковки.Штрихкод КАК Штрихкод,
		|		ДополнительныеУпаковки.Номенклатура КАК Номенклатура,
		|		ДополнительныеУпаковки.Характеристика КАК Характеристика,
		|		ДополнительныеУпаковки.Серия КАК Серия,
		|		ДополнительныеУпаковки.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
		|		ДополнительныеУпаковки.Коэффициент КАК Коэффициент,
		|		ДополнительныеУпаковки.ЕдиницаИзмеренияСсылка КАК ЕдиницаИзмеренияСсылка,
		|		ДополнительныеУпаковки.ВладелецХарактеристики КАК ВладелецХарактеристики,
		|		ДополнительныеУпаковки.ВладелецСерии КАК ВладелецСерии,
		|		ДополнительныеУпаковки.ИмяХарактеристики КАК ИмяХарактеристики,
		|		ДополнительныеУпаковки.ИмяСерии КАК ИмяСерии
		|	ИЗ
		|		(ВЫБРАТЬ
		|			КодыВесовогоТовара.Код КАК Штрихкод,
		|			ВТНоменклатура.Номенклатура КАК Номенклатура,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьХарактеристики
		|					ТОГДА КодыВесовогоТовара.ХарактеристикаНоменклатуры
		|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|			КОНЕЦ КАК Характеристика,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьСерии
		|					ТОГДА КодыВесовогоТовара.СерияНоменклатуры
		|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|			КОНЕЦ КАК Серия,
		|			ВТНоменклатура.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
		|			1 КАК Коэффициент,
		|			ВТНоменклатура.ЕдиницаИзмеренияСсылка КАК ЕдиницаИзмеренияСсылка,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьХарактеристики
		|						И КодыВесовогоТовара.ХарактеристикаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|					ТОГДА КодыВесовогоТовара.ХарактеристикаНоменклатуры.Владелец
		|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		|			КОНЕЦ КАК ВладелецХарактеристики,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьСерии
		|						И КодыВесовогоТовара.СерияНоменклатуры <> ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|					ТОГДА КодыВесовогоТовара.СерияНоменклатуры.Владелец
		|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		|			КОНЕЦ КАК ВладелецСерии,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьХарактеристики
		|						И КодыВесовогоТовара.ХарактеристикаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|					ТОГДА КодыВесовогоТовара.ХарактеристикаНоменклатуры.Наименование
		|				ИНАЧЕ """"
		|			КОНЕЦ КАК ИмяХарактеристики,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьСерии
		|						И КодыВесовогоТовара.СерияНоменклатуры <> ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|					ТОГДА КодыВесовогоТовара.СерияНоменклатуры.Наименование
		|				ИНАЧЕ """"
		|			КОНЕЦ КАК ИмяСерии
		|		ИЗ
		|			ВТНоменклатура КАК ВТНоменклатура
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.КодыВесовогоТовара КАК КодыВесовогоТовара
		|				ПО ВТНоменклатура.Номенклатура = КодыВесовогоТовара.Номенклатура
		|					И (ВЫБОР
		|						КОГДА &РежимЗапроса = ""ПоискПоНоменклатуре""
		|								ИЛИ &РежимЗапроса = ""ПоискПоНоменклатуреУпаковке""
		|								ИЛИ &РежимЗапроса = ""СписокНоменклатурыДляГрупп""
		|							ТОГДА ЛОЖЬ
		|						КОГДА &РежимЗапроса = ""ПоискПоАртикулуКодуШК""
		|							ТОГДА ВЫБОР
		|									КОГДА &ЭтоВесовойТовар
		|										ТОГДА КодыВесовогоТовара.Код = &ЧислоПоиска
		|									ИНАЧЕ ЛОЖЬ
		|								КОНЕЦ
		|						ИНАЧЕ ИСТИНА
		|					КОНЕЦ)
		|		
		|		ОБЪЕДИНИТЬ ВСЕ
		|		
		|		ВЫБРАТЬ
		|			Штрихкоды.Штрихкод,
		|			ВТНоменклатура.Номенклатура,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьХарактеристики
		|					ТОГДА Штрихкоды.ХарактеристикаНоменклатуры
		|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|			КОНЕЦ,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьСерии
		|					ТОГДА Штрихкоды.СерияНоменклатуры
		|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|			КОНЕЦ,
		|			ЕСТЬNULL(Штрихкоды.ЕдиницаИзмерения.Наименование, ВТНоменклатура.ЕдиницаИзмерения),
		|			ВЫБОР
		|				КОГДА Штрихкоды.ЕдиницаИзмерения.Коэффициент = 0
		|					ТОГДА 1
		|				ИНАЧЕ ЕСТЬNULL(Штрихкоды.ЕдиницаИзмерения.Коэффициент, 1)
		|			КОНЕЦ,
		|			ЕСТЬNULL(Штрихкоды.ЕдиницаИзмерения, ВТНоменклатура.ЕдиницаИзмеренияСсылка),
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьХарактеристики
		|						И Штрихкоды.ХарактеристикаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|					ТОГДА Штрихкоды.ХарактеристикаНоменклатуры.Владелец
		|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		|			КОНЕЦ,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьСерии
		|						И Штрихкоды.СерияНоменклатуры <> ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|					ТОГДА Штрихкоды.СерияНоменклатуры.Владелец
		|				ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		|			КОНЕЦ,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьХарактеристики
		|						И Штрихкоды.ХарактеристикаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|					ТОГДА Штрихкоды.ХарактеристикаНоменклатуры.Наименование
		|				ИНАЧЕ """"
		|			КОНЕЦ,
		|			ВЫБОР
		|				КОГДА ВТНоменклатура.ЕстьСерии
		|						И Штрихкоды.СерияНоменклатуры <> ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|					ТОГДА Штрихкоды.СерияНоменклатуры.Наименование
		|				ИНАЧЕ """"
		|			КОНЕЦ
		|		ИЗ
		|			ВТНоменклатура КАК ВТНоменклатура
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.Штрихкоды КАК Штрихкоды
		|				ПО ВТНоменклатура.Номенклатура = Штрихкоды.Владелец
		|					И (ВЫБОР
		|						КОГДА &РежимЗапроса = ""ПоискПоНоменклатуре""
		|								ИЛИ &РежимЗапроса = ""СписокНоменклатурыДляГрупп""
		|							ТОГДА ЛОЖЬ
		|						КОГДА &РежимЗапроса = ""ПоискПоАртикулуКодуШК""
		|							ТОГДА ВЫБОР
		|									КОГДА &ЭтоВесовойТовар
		|										ТОГДА ЛОЖЬ
		|									ИНАЧЕ Штрихкоды.Штрихкод ПОДОБНО &СтрокаПоиска
		|								КОНЕЦ
		|						КОГДА &РежимЗапроса = ""ПоискПоНоменклатуреУпаковке""
		|								ИЛИ &РежимЗапроса = ""ПоискПоМассивамНоменклатурыУпаковки""
		|							ТОГДА Штрихкоды.ЕдиницаИзмерения В (&ПараметрУпаковки)
		|						ИНАЧЕ ИСТИНА
		|					КОНЕЦ)
		|		
		|		ОБЪЕДИНИТЬ ВСЕ
		|		
		|		ВЫБРАТЬ
		|			"""",
		|			ВТНоменклатура.Номенклатура,
		|			ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
		|			ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка),
		|			ЕдиницыИзмерения.Наименование,
		|			ВЫБОР
		|				КОГДА ЕдиницыИзмерения.Коэффициент = 0
		|					ТОГДА 1
		|				ИНАЧЕ ЕдиницыИзмерения.Коэффициент
		|			КОНЕЦ,
		|			ЕдиницыИзмерения.Ссылка,
		|			ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|			ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|			"""",
		|			""""
		|		ИЗ
		|			ВТНоменклатура КАК ВТНоменклатура
		|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ЕдиницыИзмерения КАК ЕдиницыИзмерения
		|				ПО ВТНоменклатура.Номенклатура = ЕдиницыИзмерения.Владелец
		|					И (ВЫБОР
		|						КОГДА &РежимЗапроса = ""ПоискПоНоменклатуре""
		|								ИЛИ &РежимЗапроса = ""ПоискПоАртикулуКодуШК""
		|								ИЛИ &РежимЗапроса = ""СписокНоменклатурыДляГрупп""
		|							ТОГДА ЛОЖЬ
		|						КОГДА &РежимЗапроса = ""ПоискПоНоменклатуреУпаковке""
		|								ИЛИ &РежимЗапроса = ""ПоискПоМассивамНоменклатурыУпаковки""
		|							ТОГДА ЕдиницыИзмерения.Ссылка В (&ПараметрУпаковки)
		|						ИНАЧЕ ИСТИНА
		|					КОНЕЦ)) КАК ДополнительныеУпаковки
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		"""",
		|		ВТНоменклатура.Номенклатура,
		|		ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка),
		|		ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка),
		|		ВТНоменклатура.ЕдиницаИзмерения,
		|		1,
		|		ВТНоменклатура.ЕдиницаИзмеренияСсылка,
		|		ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|		ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|		"""",
		|		""""
		|	ИЗ
		|		ВТНоменклатура КАК ВТНоменклатура
		|	ГДЕ
		|		ВЫБОР
		|				КОГДА &РежимЗапроса = ""ПоискПоАртикулуКодуШК""
		|					ТОГДА ВЫБОР
		|							КОГДА &ЭтоВесовойТовар
		|								ТОГДА ЛОЖЬ
		|							ИНАЧЕ ВТНоменклатура.Код ПОДОБНО &СтрокаПоиска
		|									ИЛИ ВТНоменклатура.Артикул ПОДОБНО &СтрокаПоиска
		|						КОНЕЦ
		|				КОГДА &РежимЗапроса = ""ПоискПоНоменклатуреУпаковке""
		|						ИЛИ &РежимЗапроса = ""ПоискПоМассивамНоменклатурыУпаковки""
		|					ТОГДА ВТНоменклатура.ЕдиницаИзмеренияСсылка В (&ПараметрУпаковки)
		|				ИНАЧЕ ИСТИНА
		|			КОНЕЦ) КАК ВложенныйЗапрос
		|
		|СГРУППИРОВАТЬ ПО
		|	ВложенныйЗапрос.ИмяСерии,
		|	ВложенныйЗапрос.ЕдиницаИзмерения,
		|	ВложенныйЗапрос.ЕдиницаИзмеренияСсылка,
		|	ВложенныйЗапрос.Номенклатура,
		|	ВложенныйЗапрос.Серия,
		|	ВложенныйЗапрос.ИмяХарактеристики,
		|	ВложенныйЗапрос.Характеристика,
		|	ВложенныйЗапрос.Штрихкод,
		|	ВложенныйЗапрос.Коэффициент
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Номенклатура,
		|	Характеристика,
		|	Серия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВТНоменклатура.Номенклатура КАК Номенклатура,
		|	ВЫБОР
		|		КОГДА ВТНоменклатура.ЕстьХарактеристики
		|			ТОГДА ЦеныНоменклатурыСрезПоследних.ХарактеристикаНоменклатуры
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|	КОНЕЦ КАК Характеристика,
		|	ЦеныНоменклатурыСрезПоследних.Период КАК Период,
		|	МАКСИМУМ(ЦеныНоменклатурыСрезПоследних.Цена) КАК Цена
		|ПОМЕСТИТЬ ВТВсеЦены
		|ИЗ
		|	ВТНоменклатура КАК ВТНоменклатура
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
		|				,
		|				Номенклатура В
		|						(ВЫБРАТЬ
		|							ВТНоменклатура.Номенклатура
		|						ИЗ
		|							ВТНоменклатура КАК ВТНоменклатура)
		|					И ВЫБОР
		|						КОГДА &ИспользоватьОграничениеПоТипамЦен
		|							ТОГДА ТипЦен В (&ТипЦен)
		|						ИНАЧЕ ИСТИНА
		|					КОНЕЦ) КАК ЦеныНоменклатурыСрезПоследних
		|		ПО ВТНоменклатура.Номенклатура = ЦеныНоменклатурыСрезПоследних.Номенклатура
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТНоменклатура.Номенклатура,
		|	ЦеныНоменклатурыСрезПоследних.Период,
		|	ВЫБОР
		|		КОГДА ВТНоменклатура.ЕстьХарактеристики
		|			ТОГДА ЦеныНоменклатурыСрезПоследних.ХарактеристикаНоменклатуры
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|	КОНЕЦ
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Номенклатура,
		|	Характеристика,
		|	Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВТВсеЦены.Номенклатура КАК Номенклатура,
		|	ВТВсеЦены.Характеристика КАК Характеристика,
		|	МАКСИМУМ(ВТВсеЦены.Период) КАК Период
		|ПОМЕСТИТЬ ВТПоследниеЦены
		|ИЗ
		|	ВТВсеЦены КАК ВТВсеЦены
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТВсеЦены.Номенклатура,
		|	ВТВсеЦены.Характеристика
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Номенклатура,
		|	Характеристика,
		|	Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВТПоследниеЦены.Номенклатура КАК Номенклатура,
		|	ВТПоследниеЦены.Характеристика КАК Характеристика,
		|	МАКСИМУМ(ВТВсеЦены.Цена) КАК Цена
		|ПОМЕСТИТЬ ВТЦены
		|ИЗ
		|	ВТПоследниеЦены КАК ВТПоследниеЦены
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВсеЦены КАК ВТВсеЦены
		|		ПО ВТПоследниеЦены.Номенклатура = ВТВсеЦены.Номенклатура
		|			И ВТПоследниеЦены.Характеристика = ВТВсеЦены.Характеристика
		|			И ВТПоследниеЦены.Период = ВТВсеЦены.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТПоследниеЦены.Номенклатура,
		|	ВТПоследниеЦены.Характеристика
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Номенклатура,
		|	Характеристика
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
		|	ВложенныйЗапрос.Характеристика КАК Характеристика,
		|	СУММА(ВложенныйЗапрос.Количество) КАК Количество
		|ПОМЕСТИТЬ ВТОстатки
		|ИЗ
		|	(ВЫБРАТЬ
		|		ВТНоменклатура.Номенклатура КАК Номенклатура,
		|		ВЫБОР
		|			КОГДА ВТНоменклатура.ЕстьХарактеристики
		|				ТОГДА ТоварыНаСкладахОстатки.ХарактеристикаНоменклатуры
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|		КОНЕЦ КАК Характеристика,
		|		ВЫБОР
		|			КОГДА ЛОЖЬ
		|				ТОГДА ТоварыНаСкладахОстатки.СерияНоменклатуры
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|		КОНЕЦ КАК Серия,
		|		СУММА(ТоварыНаСкладахОстатки.КоличествоОстаток) КАК Количество
		|	ИЗ
		|		ВТНоменклатура КАК ВТНоменклатура
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыНаСкладах.Остатки(
		|					,
		|					Номенклатура В
		|							(ВЫБРАТЬ
		|								ВТНоменклатура.Номенклатура
		|							ИЗ
		|								ВТНоменклатура КАК ВТНоменклатура)
		|						И ВЫБОР
		|							КОГДА &ИспользоватьОграничениеПоСкладам
		|								ТОГДА Склад В (&Склад)
		|							ИНАЧЕ ИСТИНА
		|						КОНЕЦ) КАК ТоварыНаСкладахОстатки
		|			ПО ВТНоменклатура.Номенклатура = ТоварыНаСкладахОстатки.Номенклатура
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВТНоменклатура.Номенклатура,
		|		ВЫБОР
		|			КОГДА ЛОЖЬ
		|				ТОГДА ТоварыНаСкладахОстатки.СерияНоменклатуры
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВТНоменклатура.ЕстьХарактеристики
		|				ТОГДА ТоварыНаСкладахОстатки.ХарактеристикаНоменклатуры
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|		КОНЕЦ
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ВТНоменклатура.Номенклатура,
		|		ВЫБОР
		|			КОГДА ВТНоменклатура.ЕстьХарактеристики
		|				ТОГДА ТоварыВРозницеОстатки.ХарактеристикаНоменклатуры
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ЛОЖЬ
		|				ТОГДА ТоварыВРозницеОстатки.СерияНоменклатуры
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|		КОНЕЦ,
		|		СУММА(ТоварыВРозницеОстатки.КоличествоОстаток)
		|	ИЗ
		|		ВТНоменклатура КАК ВТНоменклатура
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВРознице.Остатки(
		|					,
		|					Номенклатура В
		|							(ВЫБРАТЬ
		|								ВТНоменклатура.Номенклатура
		|							ИЗ
		|								ВТНоменклатура КАК ВТНоменклатура)
		|						И ВЫБОР
		|							КОГДА &ИспользоватьОграничениеПоСкладам
		|								ТОГДА Склад В (&Склад)
		|							ИНАЧЕ ИСТИНА
		|						КОНЕЦ) КАК ТоварыВРозницеОстатки
		|			ПО ВТНоменклатура.Номенклатура = ТоварыВРозницеОстатки.Номенклатура
		|	
		|	СГРУППИРОВАТЬ ПО
		|		ВТНоменклатура.Номенклатура,
		|		ВЫБОР
		|			КОГДА ЛОЖЬ
		|				ТОГДА ТоварыВРозницеОстатки.СерияНоменклатуры
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
		|		КОНЕЦ,
		|		ВЫБОР
		|			КОГДА ВТНоменклатура.ЕстьХарактеристики
		|				ТОГДА ТоварыВРозницеОстатки.ХарактеристикаНоменклатуры
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)
		|		КОНЕЦ) КАК ВложенныйЗапрос
		|
		|СГРУППИРОВАТЬ ПО
		|	ВложенныйЗапрос.Номенклатура,
		|	ВложенныйЗапрос.Характеристика
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Номенклатура,
		|	Характеристика
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВТУпаковки.Номенклатура КАК Product_Id_GUID,
		|	ВТНоменклатура.Артикул КАК Product_Marking,
		|	ВТНоменклатура.Код КАК Product_Barcode,
		|	ВТНоменклатура.Наименование КАК Product_Name,
		|	ВТНоменклатура.ЭтоГруппа КАК Product_ЭтоГруппа,
		|	ВТНоменклатура.ЕдиницаИзмеренияСсылка КАК Product_BasePackingId_GUID,
		|	ВТНоменклатура.ЕстьХарактеристики КАК Product_ПоХарактеристикам,
		|	ВЫБОР
		|		КОГДА ВТНоменклатура.ЕстьХарактеристики
		|			ТОГДА ВТНоменклатура.Номенклатура
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		|	КОНЕЦ КАК Product_КлючХарактеристик_GUID,
		|	ВТНоменклатура.ЕстьСерии КАК Product_ПоСериям,
		|	ВЫБОР
		|		КОГДА ВТНоменклатура.ЕстьСерии
		|			ТОГДА ВТНоменклатура.Номенклатура
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
		|	КОНЕЦ КАК Product_КлючСерий_GUID,
		|	ВТНоменклатура.ЕстьСН КАК Product_ПоСН,
		|	ВТНоменклатура.Весовой КАК Product_Весовой,
		|	ЛОЖЬ КАК Product_Алко,
		|	ЛОЖЬ КАК Product_АлкоМарк,
		|	"""" КАК Product_АлкоОбъем,
		|	"""" КАК Product_АлкоКрепость,
		|	"""" КАК Product_АлкоПроизводитель,
		|	"""" КАК Product_АлкоПроизвИНН,
		|	"""" КАК Product_АлкоПроизвКПП,
		|	ВТУпаковки.Штрихкод КАК Packing_Barcode,
		|	ВТУпаковки.ЕдиницаИзмеренияСсылка КАК Packing_Id_GUID,
		|	ВТУпаковки.ЕдиницаИзмеренияСсылка КАК Packing_ИдЕдиницыИзмерения_GUID,
		|	ВТУпаковки.ЕдиницаИзмерения КАК Packing_Name,
		|	ВТУпаковки.Коэффициент КАК Packing_UnitsQuantity,
		|	ВТУпаковки.ИмяХарактеристики КАК Packing_ИмяХарактеристики,
		|	ВТУпаковки.Характеристика КАК Packing_ИдХарактеристики_GUID,
		|	ВТУпаковки.ИмяСерии КАК Packing_ИмяСерии,
		|	ВТУпаковки.Серия КАК Packing_ИдСерии_GUID,
		|	ЕСТЬNULL(ВТЦены.Цена, 0) КАК Packing_price,
		|	ЕСТЬNULL(ВТОстатки.Количество, 0) КАК Packing_qty,
		|	"""" КАК Packing_АлкоКод,
		|	"""" КАК Packing_АлкоОбъем,
		|	"""" КАК Packing_АлкоКрепость,
		|	"""" КАК Packing_АлкоПроизводитель,
		|	"""" КАК Packing_АлкоПроизвИНН,
		|	"""" КАК Packing_АлкоПроизвКПП
		|ИЗ
		|	ВТУпаковки КАК ВТУпаковки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТНоменклатура КАК ВТНоменклатура
		|		ПО ВТУпаковки.Номенклатура = ВТНоменклатура.Номенклатура
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЦены КАК ВТЦены
		|		ПО ВТУпаковки.Номенклатура = ВТЦены.Номенклатура
		|			И ВТУпаковки.Характеристика = ВТЦены.Характеристика
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОстатки КАК ВТОстатки
		|		ПО ВТУпаковки.Номенклатура = ВТОстатки.Номенклатура
		|			И ВТУпаковки.Характеристика = ВТОстатки.Характеристика
		|
		|УПОРЯДОЧИТЬ ПО
		|	Product_ЭтоГруппа УБЫВ,
		|	Product_Name,
		|	Product_Id_GUID,
		|	Packing_Barcode";
	
	Запрос.УстановитьПараметр("ИспользоватьОграничениеПоСкладам", Ложь);
	Запрос.УстановитьПараметр("ИспользоватьОграничениеПоТипамЦен", Ложь);
	Запрос.УстановитьПараметр("ИспользоватьХарактеристикиНоменклатуры", Ложь);
	Запрос.УстановитьПараметр("ПараметрНоменклатуры", Неопределено);
	Запрос.УстановитьПараметр("ПараметрУпаковки", Неопределено);
	Запрос.УстановитьПараметр("РежимЗапроса", "ПоискПоАртикулуКодуШК");
	Запрос.УстановитьПараметр("Склад", Неопределено);
	Запрос.УстановитьПараметр("СтрокаПоиска", "%8804014212440%");
	Запрос.УстановитьПараметр("ТипЦен", Неопределено);
	Запрос.УстановитьПараметр("ЧислоПоиска", 8804014212440);
	Запрос.УстановитьПараметр("ЭтоВесовойТовар", Ложь);
	
	ДатаВМиллисекундахНачало =  ТекущаяУниверсальнаяДатаВМиллисекундах();
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Если ВыборкаДетальныеЗаписи.Следующий() Тогда
		Сообщить("Позиция найдена:");
		Сообщить(ВыборкаДетальныеЗаписи.Product_Name);
	КонецЕсли;	
	ДатаВМиллисекундахКонец =  ТекущаяУниверсальнаяДатаВМиллисекундах();
	Сообщить("Время запроса (в миллисекундах):"+Формат(ДатаВМиллисекундахКонец - ДатаВМиллисекундахНачало,""));
	//}}КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА

КонецПроцедуры
