<?xml version="1.0" encoding="utf-8"?><Operation xmlns:clr="http://schemas.cleverence.ru/clr" comment="ЕГАИС 3 | sh | Обработка микс-коробки и палеты" fullscreen="Inherit" lock="AllOperations" name="ЕГАИС3 ОтгрузкаОбработкаМногоСтрокНовая v2" serverHosted="True"><Actions capacity="8" count="6"><AssignAction breakPoint="False" expression="i = 0;&#xD;&#xA;БутылокДобавлено = 0;" id="7e1626d1-2cae-4b66-9cbd-5adcf2f532f4" indent="0" nextDirection="" /><ForeachAction breakPoint="False" buttonExit="True" canFinishAlways="False" cyclic="True" exitButtonText="Закончить набор" exitGroupCode="" fullscreen="Inherit" id="ea1b4526-18e9-4cbe-ba81-e3d502401742" indent="0" items="{ЕстьВТаблице}" nextDirection="" transactionNotch="False"><Actions capacity="8" count="7"><SelectDocumentLinesAction breakPoint="False" id="ece94c50-9622-48c5-8955-be3cefa5282d" indent="0" name="5" nextDirection="" sessionVariable="ПланСтрокиИщем"><Query copySelection="False" documentLines="Declared" sourceWhereExpression="" useTableAliasForItem="False" whereCompiled="False" whereExpression="(Item.ProductId == &quot;&quot; || Item.ProductId == SelectedLine.КодНоменклатуры) &amp;&amp; (Item.АлкоКод == &quot;&quot; || Item.АлкоКод == SelectedLine.АлкоКод) &amp;&amp; (Item.АлкоНаим == &quot;&quot; || Item.АлкоНаим == SelectedLine.АлкоНаим) &amp;&amp; (Item.СкладСерия == &quot;&quot; || Item.СкладСерия == SelectedLine.СкладСерия)"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><ConditionAction breakPoint="False" expression="ПланСтрокиИщем.Count == 0" id="4da52f8c-8e74-4059-8771-8bbe345daf9d" indent="0" nextDirection="" noDirection="7" yesDirection="" /><AssignAction breakPoint="False" expression="НеПодходит = true" id="56ae9950-4ac6-4341-8718-e12bfe6a204d" indent="1" nextDirection="return" /><AssignAction breakPoint="False" expression="Сканировано = SelectedLine" id="2e88fd83-6c44-4fe8-abf0-f504064b9adf" indent="0" name="7" nextDirection="" /><ForeachAction breakPoint="False" buttonExit="True" canFinishAlways="False" cyclic="True" exitButtonText="Закончить набор" exitGroupCode="" fullscreen="Inherit" id="0038b290-dc79-4c3a-950a-9f79b8ec297f" indent="0" items="{ПланСтрокиИщем}" name="6" nextDirection="" transactionNotch="False"><Actions capacity="16" count="10"><AssignAction breakPoint="False" expression="Успех = false" id="18a1c5b1-46f6-4802-8650-95f9d986015c" indent="0" nextDirection="" /><SelectDocumentLinesAction breakPoint="False" id="8fedf520-3aae-418e-8d9b-30ee01279067" indent="0" nextDirection="" sessionVariable="СчитаемУжеДобавленныеБутылки"><Query copySelection="False" documentLines="Current" sourceWhereExpression="" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.Коробка == Сканировано.Коробка"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><SelectDocumentLineAction breakPoint="False" id="42cd7ae5-18f1-4959-860e-1cb1ebcc49f5" indent="0" name="3" nextDirection="" sessionVariable="ИщемВЗапомненных"><Query copySelection="False" documentLines="Declared" from="{Запоминаем}" sourceWhereExpression="" tableAlias="{Запоминаем}" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.ЮИД == SelectedLine.Uid"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLineAction><ConditionAction breakPoint="False" expression="ИщемВЗапомненных != null" id="2271366b-469c-41ef-8303-12255b033217" indent="0" nextDirection="" noDirection="1" yesDirection="" /><ConditionAction breakPoint="False" expression="ИщемВЗапомненных.DeclaredQuantity &gt;= ИщемВЗапомненных.CurrentQuantity + Сканировано.Количество - СчитаемУжеДобавленныеБутылки.Count" id="5f9fedf8-c3f6-4f60-92de-72b690de7cf1" indent="1" name="1 1" nextDirection="" noDirection="continue" yesDirection="" /><AssignAction breakPoint="False" expression="ИщемВЗапомненных.CurrentQuantity = ИщемВЗапомненных.CurrentQuantity + Сканировано.Количество;&#xD;&#xA;НоваяСтрока = ДляЗанесения.AddNew();&#xD;&#xA;НоваяСтрока.ЮИД = SelectedLine.Uid;&#xD;&#xA;Успех = true;" id="eedba8fd-f885-41e5-9b6b-6c56d78f998e" indent="2" nextDirection="break" /><ConditionAction breakPoint="False" expression="SelectedLine.DeclaredQuantity &gt;= SelectedLine.CurrentQuantity + Сканировано.Количество - СчитаемУжеДобавленныеБутылки.Count" id="120b5b63-8ea8-44b3-b9dd-a3aba694e71a" indent="0" name="1" nextDirection="" noDirection="continue" yesDirection="2" /><AssignAction breakPoint="False" expression="НовСтрока = Запоминаем.AddNew();&#xD;&#xA;НовСтрока.ЮИД = SelectedLine.Uid;&#xD;&#xA;НовСтрока.CurrentQuantity = SelectedLine.CurrentQuantity;&#xD;&#xA;НовСтрока.DeclaredQuantity = SelectedLine.DeclaredQuantity;&#xD;&#xA;НоваяСтрока = ДляЗанесения.AddNew();&#xD;&#xA;НоваяСтрока.ЮИД = SelectedLine.Uid;&#xD;&#xA;Успех = true;" id="c2e58c33-dbce-46e0-a1c4-d409002d4026" indent="0" name="2" nextDirection="" /><SelectDocumentLineAction breakPoint="False" id="0adefd58-ae7b-4c7a-ba12-6ed50a26da47" indent="0" name="3 1" nextDirection="" sessionVariable="Прибавляем"><Query copySelection="False" documentLines="Declared" from="{Запоминаем}" sourceWhereExpression="" tableAlias="{Запоминаем}" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.ЮИД == SelectedLine.Uid"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLineAction><AssignAction breakPoint="False" expression="Прибавляем.CurrentQuantity = Прибавляем.CurrentQuantity + Сканировано.Количество" id="39c8d5b1-cedd-46ff-9186-f32fd6d4b7cf" indent="0" nextDirection="break" /></Actions><LockObjects count="0" /></ForeachAction><ConditionAction breakPoint="False" expression="Успех == true" id="9f4dc756-6bcb-48ae-a89c-ba44e24ccc69" indent="0" nextDirection="" noDirection="" yesDirection="continue" /><AssignAction breakPoint="False" expression="НеПодходит = true;&#xD;&#xA;Превышение = true;" id="cb73d3e1-eeda-4b73-a477-8c768bae8034" indent="0" nextDirection="return" /></Actions><LockObjects count="0" /></ForeachAction><ForeachAction breakPoint="False" buttonExit="True" canFinishAlways="False" cyclic="True" exitButtonText="Закончить набор" exitGroupCode="" fullscreen="Inherit" id="5a0a00cf-d192-44aa-86c7-08d2d2d544fb" indent="0" items="{ЕстьВТаблице}" name="1" nextDirection="" transactionNotch="False"><Actions capacity="8" count="8"><SelectDocumentLineAction breakPoint="False" id="4c68c785-bc9c-4f9c-ab01-3f4f9ec6c72d" indent="0" name="Для одной строки 1" nextDirection="" sessionVariable="ПланСтрока"><Query copySelection="False" documentLines="Declared" from="" sourceWhereExpression="" tableAlias="" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.Uid == ДляЗанесения[i].ЮИД"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLineAction><AssignAction breakPoint="False" expression="i = i +1;&#xD;&#xA;БутылокДобавлено = БутылокДобавлено + SelectedLine.Количество;" id="bf516bb4-da07-4edd-a784-b56c017063f5" indent="0" nextDirection="" /><SelectDocumentLinesAction breakPoint="False" id="f48ac57f-d429-4ce4-a519-9ba638fcb848" indent="0" name="3 1" nextDirection="" sessionVariable="ПередДобавлениемКоробки"><Query copySelection="False" documentLines="Current" from="" sourceWhereExpression="" tableAlias="" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.Коробка == SelectedLine.Коробка"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><ConditionAction breakPoint="False" expression="ПередДобавлениемКоробки.Count != 0" id="ddd7da28-7768-4276-a85b-4e8e9567011b" indent="0" nextDirection="" noDirection="4 1" yesDirection="1" /><AssignAction breakPoint="False" expression="ПланСтрока.CurrentQuantity = ПланСтрока.CurrentQuantity - ПередДобавлениемКоробки.Count" id="cfe56493-00ad-407f-bd0c-08109e53e3e9" indent="1" name="1" nextDirection="" /><RemoveDocumentLineAction breakPoint="False" id="e81bf8b2-b24d-4a4e-9241-774e23c36f0c" indent="0" nextDirection="" packing="" quantity="" quantityErrorDirection="" sessionVariable="ПередДобавлениемКоробки" /><AssignAction breakPoint="False" expression="КоробкаДляЗанесения = SelectedLine.Clone();&#xD;&#xA;КоробкаДляЗанесения.ПланСтрокаИд = ПланСтрока.Uid;&#xD;&#xA;КоробкаДляЗанесения.ЗанесениеПользовательИд = ТекущийПользователь;&#xD;&#xA;КоробкаДляЗанесения.ЗанесениеДата = CurrentDate;" id="2f8a3eec-a3f3-4014-8962-afaf6900817e" indent="0" name="4 1" nextDirection="" /><AssignAction breakPoint="False" comment="Запись в документ" expression="Document.КоробкиФакт.Rows.Add(КоробкаДляЗанесения);&#xD;&#xA;ПланСтрока.CurrentQuantity = ПланСтрока.CurrentQuantity + КоробкаДляЗанесения.Количество;&#xD;&#xA;ДобавленаКоробка = true;" id="9b844c0a-c0b9-4208-b650-0e7ef1d0d7cd" indent="0" name="2 1" nextDirection="continue" /></Actions><LockObjects count="0" /></ForeachAction><AssignAction breakPoint="False" expression="ДобавленМикс = true;&#xD;&#xA;ШКМикса = ScannedBarcode;" id="c0453a64-6616-407b-9d11-0fda177bcb27" indent="0" nextDirection="" /><ConditionAction breakPoint="False" expression="ЭтоПалета == true" id="0ab3d400-135a-41bf-a9eb-f1845ec3ba13" indent="0" nextDirection="" noDirection="return" yesDirection="" /><AssignAction breakPoint="False" expression="БылаПалета = true" id="12dede9c-8934-484a-b237-726f67624049" indent="1" nextDirection="return" /></Actions><Parameters capacity="8" count="7"><FieldInfo alias="" eanAI="None" fieldName="ЭтоПалета" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="EtoPaleta" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ЭтоКоробка" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="EtoKorobka" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ЕстьВТаблице" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="EstVTablice" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ScannedBarcode" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ScannedBarcode" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="Запоминаем" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="Zapominaem" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ДляЗанесения" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="DlyaZaneseniya" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ТекущийПользователь" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="TekushhijPolzovatel" valueTemplate="" /></Parameters><Returns capacity="8" count="7"><ReturnFieldInfo alias="" eanAI="None" fieldName="НеПодходит" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="NePodhodit" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="Превышение" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="Prevyshenie" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="БутылокДобавлено" fieldType="Int32" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="ButylokDobavleno" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ДобавленМикс" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="DobavlenMiks" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="БылаПалета" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="BylaPaleta" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ШКМикса" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="ShKMiksa" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="Запоминаем" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="Zapominaem" valueTemplate="" /></Returns></Operation>