<?xml version="1.0" encoding="utf-8"?><Operation xmlns:clr="http://schemas.cleverence.ru/clr" comment="sh" fullscreen="Inherit" lock="No" name="ЗанесениеВДокументКоллективное" serverHosted="True"><Actions capacity="64" count="50"><AssignAction breakPoint="False" comment="Если это уникально маркированная позиция, то ищем ее в плане" expression="if (SelectedProduct.Марка != &quot;&quot;)&#xD;&#xA;SelectedLine = Document.DeclaredItems.FindFirstByField(&quot;Марка&quot;,SelectedProduct.Марка);" id="404afd68-9510-4d0a-8582-e5a19b71272f" indent="0" nextDirection="" /><ConditionAction breakPoint="False" comment="Нашли марку в плановых строках?" expression="SelectedLine != null" id="d890ad8d-519b-46c4-8cbb-f7236ba54920" indent="0" nextDirection="" noDirection="17" yesDirection="" /><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="True" combineEqualCurrentItems="False" declaredExpression="" errorQuantityMessage="Товара больше, чем разрешает документ." id="39333156-3c94-4889-a844-e68a92e548b9" ignoreFieldsInDocument="False" indent="1" nextDirection="7" noProductErrorDirection="25" noProductInDocumentMessage="Такой товар отсутствует в документе." onlyInCurrentItems="False" quantityErrorDirection="65" useSelectedLine="True"><ComparingFieldNames count="1"><String>Марка</String></ComparingFieldNames><ComparingFieldNamesForCurrentItems count="0" /></AcceptInDocumentAction><ConditionAction breakPoint="False" expression="SelectedProduct.Алко == true" id="b74907b0-0612-46ee-aaaf-a314894d3004" indent="0" name="17" nextDirection="" noDirection="Проверка принадлежности товара1" yesDirection="" /><AssignAction breakPoint="False" comment="                 // Попытка реализовать запись товара, если в плане он выгружен как неизвестный" expression="if(SelectedProduct.АлкоКод!=&quot;&quot;){&#xD;&#xA;MemSelectedLine = SelectedLine;&#xD;&#xA;СтрокиАлкоКода = Document.DeclaredItems.FindByField(&quot;АлкоКод&quot;,SelectedProduct.АлкоКод);}" id="cc11a2ee-7871-47c1-b721-c165907fbf69" indent="0" name="14" nextDirection="27" /><ConditionAction breakPoint="False" expression="СтрокиАлкоКода != null&amp;&amp;СтрокиАлкоКода.Count != 0" id="8ecb6537-5a61-451b-947f-2f4728e7ef05" indent="0" name="27" nextDirection="" noDirection="14Old" yesDirection="" /><SelectDocumentLinesAction breakPoint="False" id="76256ee4-bc35-4b66-b80b-c3c40092414f" indent="0" nextDirection="" sessionVariable="SelectedLines"><Query copySelection="False" documentLines="Declared" from="СтрокиАлкоКода" sourceWhereExpression="" tableAlias="СтрокиАлкоКода" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.ProductId!=SelectedProduct.Product.Id"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><ConditionAction breakPoint="False" expression="SelectedLines.Count &gt; 0" id="dc0696df-8fec-4461-a9c2-5b6df1e93925" indent="0" name="ЕслиВДокументеЕстьПланАлкокод 1" nextDirection="" noDirection="14Old" yesDirection="" /><SelectDocumentLineAction breakPoint="False" id="dcaab103-9deb-4c34-931e-73de2eb39aaa" indent="0" nextDirection="" sessionVariable="SelectedLine"><Query copySelection="False" documentLines="Declared" from="SelectedLines" sourceWhereExpression="" tableAlias="SelectedLines" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.CurrentQuantity &lt; Item.DeclaredQuantity "><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLineAction><ConditionAction breakPoint="False" expression="SelectedLine == null" id="cc78a230-2593-4d47-8376-af0eb8aa52d0" indent="0" nextDirection="" noDirection="ЕслиВДокументеЕстьПланАлкокод" yesDirection="" /><AssignAction breakPoint="False" expression="SelectedLine = SelectedLines[0]" id="4e6e05d1-9f2e-4727-84e2-194b5a8acb94" indent="1" nextDirection="" /><ConditionAction breakPoint="False" expression="SelectedLine!=null" id="98294cee-d379-469f-b002-e10aaf35cf77" indent="0" name="ЕслиВДокументеЕстьПланАлкокод" nextDirection="" noDirection="14Old" yesDirection="14New" /><ConditionAction breakPoint="False" expression="Document.КонтрольКолва == 1 &amp;&amp; КонтрольТовараБезКолич == false" id="520297bc-6495-4a9c-910e-f645c8f002a5" indent="0" name="14New" nextDirection="" noDirection="запись 1" yesDirection="РучнойКонтроль" /><ConditionAction breakPoint="False" expression="SelectedLine.CurrentQuantity+SelectedProduct.Quantity&gt;SelectedLine.DeclaredQuantity" id="3d760b5f-1fc1-484f-b117-b22e683881a2" indent="0" name="РучнойКонтроль" nextDirection="" noDirection="запись 1" yesDirection="65" /><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="False" combineEqualCurrentItems="True" declaredExpression="" errorQuantityMessage="" id="d8debcac-124b-4bd0-9388-d00be884ff2a" ignoreFieldsInDocument="False" indent="1" name="запись 1" nextDirection="ПоправитьПланДляОтображения" noProductErrorDirection="" noProductInDocumentMessage="" onlyInCurrentItems="True" quantityErrorDirection="" useSelectedLine="True"><ComparingFieldNames count="1"><String>АлкоКод</String></ComparingFieldNames><ComparingFieldNamesForCurrentItems count="4"><String>Марка</String><String>КодСтроки</String><String>АлкоКод</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="True" combineEqualCurrentItems="True" declaredExpression="" errorQuantityMessage="" id="8353c425-f61a-4e12-bb93-624c63e7f90b" ignoreFieldsInDocument="False" indent="1" name="ЗаписьТолькоВФакт" nextDirection="ПоправитьПланДляОтображения" noProductErrorDirection="25" noProductInDocumentMessage="" onlyInCurrentItems="True" quantityErrorDirection="65" useSelectedLine="True"><ComparingFieldNames count="1"><String>АлкоКод</String></ComparingFieldNames><ComparingFieldNamesForCurrentItems count="4"><String>Марка</String><String>КодСтроки</String><String>АлкоКод</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><AssignAction breakPoint="False" expression="if(LastChangedCurrentItems.Count!=0&amp;&amp;LastChangedCurrentItems[0].DeclaredQuantity==0)&#xD;&#xA;LastChangedCurrentItems[0].DeclaredQuantity = SelectedLine.DeclaredQuantity;&#xD;&#xA;SelectedLine.CurrentQuantity = SelectedLine.CurrentQuantity+SelectedProduct.Quantity;&#xD;&#xA;SelectedLine = MemSelectedLine;" id="603e2cf4-3c98-4c70-bc60-b7f781b0f9c6" indent="1" name="ПоправитьПланДляОтображения" nextDirection="7" /><ConditionAction breakPoint="False" expression="Document.КонтрольКолва == 1 &amp;&amp; КонтрольТовараБезКолич == false" id="1f5ebb97-21f7-4197-9c2c-2839e6368c8e" indent="0" name="14Old" nextDirection="" noDirection="запись" yesDirection="С проверкой" /><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="False" combineEqualCurrentItems="True" declaredExpression="" errorQuantityMessage="" id="ab72750a-3af0-44c6-8de6-0e8fe3cd8fe7" ignoreFieldsInDocument="False" indent="1" name="запись" nextDirection="7" noProductErrorDirection="" noProductInDocumentMessage="" onlyInCurrentItems="False" quantityErrorDirection="" useSelectedLine="False"><ComparingFieldNames count="1"><String>АлкоКод</String></ComparingFieldNames><ComparingFieldNamesForCurrentItems count="4"><String>Марка</String><String>КодСтроки</String><String>АлкоКод</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="True" combineEqualCurrentItems="True" declaredExpression="" errorQuantityMessage="" id="7da58396-e684-483f-9fe3-837f55a5aab0" ignoreFieldsInDocument="False" indent="1" name="С проверкой" nextDirection="7" noProductErrorDirection="25" noProductInDocumentMessage="" onlyInCurrentItems="False" quantityErrorDirection="65" useSelectedLine="False"><ComparingFieldNames count="1"><String>АлкоПДФ</String></ComparingFieldNames><ComparingFieldNamesForCurrentItems count="4"><String>Марка</String><String>КодСтроки</String><String>АлкоКод</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><ConditionAction breakPoint="False" expression="Document.КонтрольКолва == 1 &amp;&amp; КонтрольТовараБезКолич == false" id="1f4089da-5e79-4e4c-943b-d307906d56a8" indent="0" name="Проверка принадлежности товара1" nextDirection="" noDirection="11" yesDirection="12" /><ConditionAction breakPoint="False" expression="SelectedProduct.Product.Id == UnknownProduct.Id" id="ccfce543-6a9d-4f76-bc22-b5dc0a9c7380" indent="1" name="11" nextDirection="" noDirection="13" yesDirection="" /><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="False" combineEqualCurrentItems="True" declaredExpression="(Item.Марка == SelectedProduct.Марка &amp;&amp; Item.Марка !=&quot;&quot; &amp;&amp; Item.Марка != null) || ((SelectedProduct.Алко==false || Item.АлкоКод == SelectedProduct.АлкоКод) &amp;&amp; (SelectedProduct.Алко==true || Item.ШК == SelectedProduct.ШК) &amp;&amp; (ПоДатеРозлива==false || Item.ДатаРозлива == SelectedProduct.ДатаРозлива))" errorQuantityMessage="" id="83649c81-a4d5-451d-bead-1a7c2c63dab5" ignoreFieldsInDocument="False" indent="2" name="Обычная запись 1" nextDirection="7" noProductErrorDirection="" noProductInDocumentMessage="" onlyInCurrentItems="False" quantityErrorDirection="" useSelectedLine="False"><ComparingFieldNames count="3"><String>ШК</String><String>Характеристика</String><String>ИдСерии</String></ComparingFieldNames><ComparingFieldNamesForCurrentItems capacity="16" count="14"><String>FirstStorageBarcode</String><String>Марка</String><String>КодСтроки</String><String>ИмяХарактеристики</String><String>ИмяСерии</String><String>ШК</String><String>СН</String><String>Цена</String><String>ЦенаПриемки</String><String>НомерСтрокиДокумента</String><String>АлкоСН</String><String>АлкоКод</String><String>АлкоПДФ</String><String>ДатаРозлива</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><ConditionAction breakPoint="False" expression="SelectedProduct.Product.Весовой == true" id="a72cb572-5098-45ae-b1d8-8633ce6b31be" indent="1" name="13" nextDirection="" noDirection="ЕслиВыгруженаЯчейка" yesDirection="" /><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="False" combineEqualCurrentItems="False" declaredExpression="(Item.Марка == SelectedProduct.Марка &amp;&amp; Item.Марка !=&quot;&quot; &amp;&amp; Item.Марка != null) || (Item.ИдХарактеристики == SelectedProduct.ИдХарактеристики &amp;&amp; (Item.ИдСерии == &quot;&quot; || Item.ИдСерии == SelectedProduct.ИдСерии) &amp;&amp; (Item.АлкоКод == &quot;&quot; || Item.АлкоКод == SelectedProduct.АлкоКод) &amp;&amp; (ПоДатеРозлива==false || Item.ДатаРозлива == null || Item.ДатаРозлива.Ticks == 0 || Item.ДатаРозлива == SelectedProduct.ДатаРозлива))" errorQuantityMessage="" id="10848bc4-6c71-4956-85b6-5c9cc5fb1034" ignoreFieldsInDocument="False" indent="2" name="Обычная запись весовой" nextDirection="7" noProductErrorDirection="" noProductInDocumentMessage="" onlyInCurrentItems="False" quantityErrorDirection="" useSelectedLine="False"><ComparingFieldNames count="0" /><ComparingFieldNamesForCurrentItems capacity="16" count="15"><String>FirstStorageBarcode</String><String>Марка</String><String>КодСтроки</String><String>ИмяХарактеристики</String><String>СН</String><String>Цена</String><String>ЦенаПриемки</String><String>НомерСтрокиДокумента</String><String>ИдСерии</String><String>ИдХарактеристики</String><String>ИдЕдиницыИзмерения</String><String>АлкоСН</String><String>АлкоКод</String><String>ДатаРозлива</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="False" combineEqualCurrentItems="True" declaredExpression="(Item.Марка == SelectedProduct.Марка &amp;&amp; Item.Марка !=&quot;&quot; &amp;&amp; Item.Марка != null) || ((Document.CreatedOnPDA == true &amp;&amp; SelectedProduct.Product.Маркировка == &quot;Табак&quot; &amp;&amp; Item.PackingId == SelectedProduct.PackingId)||((SelectedProduct.Product.Маркировка != &quot;Табак&quot; || Document.CreatedOnPDA == false) &amp;&amp; Item.ИдХарактеристики == SelectedProduct.ИдХарактеристики &amp;&amp; (Item.ИдСерии == &quot;&quot; || Item.ИдСерии == SelectedProduct.ИдСерии) &amp;&amp; (Item.АлкоКод == &quot;&quot; || Item.АлкоКод == SelectedProduct.АлкоКод) &amp;&amp; (ПоДатеРозлива==false || Item.ДатаРозлива == null || Item.ДатаРозлива == SelectedProduct.ДатаРозлива)))" errorQuantityMessage="" id="b90d3038-8869-4be1-ae0e-77452c7e1657" ignoreFieldsInDocument="False" indent="2" name="Обычная запись" nextDirection="7" noProductErrorDirection="" noProductInDocumentMessage="" onlyInCurrentItems="False" quantityErrorDirection="" useSelectedLine="False"><ComparingFieldNames count="0" /><ComparingFieldNamesForCurrentItems capacity="32" count="19"><String>FirstStorageBarcode</String><String>SSCC</String><String>Марка</String><String>КодСтроки</String><String>ИмяХарактеристики</String><String>СН</String><String>Цена</String><String>ЦенаПриемки</String><String>НомерСтрокиДокумента</String><String>ИдСерии</String><String>ИдХарактеристики</String><String>ИдЕдиницыИзмерения</String><String>ИмяПользователя</String><String>ИдПользователя</String><String>ИдКоробки</String><String>АлкоСН</String><String>АлкоКод</String><String>ДатаРозлива</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><ConditionAction breakPoint="False" comment="      \\ для размещения не нужно создавать новые строки" expression="Document.CreatedOnPDA != true &amp;&amp; (Document.ИмяБП.StartsWith(&quot;Размещение товаров&quot;) != true || Document.ИмяБП == &quot;&quot;) &amp;&amp; СтрокиДляСпускаВниз.Count != 0 &amp;&amp; СтрокиДляСпускаВниз[0].FirstStorageId != null &amp;&amp; FirstStorage != null" id="6d3ea9c9-f82a-4f51-9211-3a8860e5ef12" indent="2" name="ЕслиВыгруженаЯчейка" nextDirection="" noDirection="Обычная запись" yesDirection="Обычная запись c ячейкой" /><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="False" combineEqualCurrentItems="True" declaredExpression="(Item.Марка == SelectedProduct.Марка &amp;&amp; Item.Марка !=&quot;&quot; &amp;&amp; Item.Марка != null) || ((Document.CreatedOnPDA &amp;&amp; Item.Product.Маркировка == &quot;Табак&quot; &amp;&amp; Item.PackingId == SelectedProduct.PackingId)||((SelectedProduct.Product.Маркировка != &quot;Табак&quot; || Document.CreatedOnPDA == false) &amp;&amp; Item.ИдХарактеристики == SelectedProduct.ИдХарактеристики &amp;&amp; (Item.ИдСерии == &quot;&quot; || Item.ИдСерии == SelectedProduct.ИдСерии) &amp;&amp; Item.FirstStorageId==FirstStorage.Id &amp;&amp;  (Item.АлкоКод == &quot;&quot; || Item.АлкоКод == SelectedProduct.АлкоКод) &amp;&amp; (ПоДатеРозлива==false || Item.ДатаРозлива == null || Item.ДатаРозлива.Ticks == 0 || Item.ДатаРозлива == SelectedProduct.ДатаРозлива)))" errorQuantityMessage="" id="f515ae51-329a-41f0-9dd3-5ce6098e57b0" ignoreFieldsInDocument="False" indent="2" name="Обычная запись c ячейкой" nextDirection="7" noProductErrorDirection="" noProductInDocumentMessage="" onlyInCurrentItems="False" quantityErrorDirection="" useSelectedLine="False"><ComparingFieldNames count="0" /><ComparingFieldNamesForCurrentItems capacity="32" count="19"><String>FirstStorageBarcode</String><String>SSCC</String><String>Марка</String><String>КодСтроки</String><String>ИмяХарактеристики</String><String>СН</String><String>Цена</String><String>ЦенаПриемки</String><String>НомерСтрокиДокумента</String><String>ИдСерии</String><String>ИдХарактеристики</String><String>ИдЕдиницыИзмерения</String><String>ИмяПользователя</String><String>ИдПользователя</String><String>ИдКоробки</String><String>АлкоСН</String><String>АлкоКод</String><String>ДатаРозлива</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><ConditionAction breakPoint="False" expression="SelectedProduct.Product.Весовой == true" id="0838c319-2fe8-4881-85f2-896e041657b5" indent="1" name="12" nextDirection="" noDirection="ЕслиВыгруженаЯчейка 1" yesDirection="Запись БЕЗ проверки Весовой" /><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="False" combineEqualCurrentItems="False" declaredExpression="(Item.Марка == SelectedProduct.Марка &amp;&amp; Item.Марка !=&quot;&quot; &amp;&amp; Item.Марка != null) || (Item.ИдХарактеристики == SelectedProduct.ИдХарактеристики &amp;&amp; (Item.ИдСерии == &quot;&quot; || Item.ИдСерии == SelectedProduct.ИдСерии) &amp;&amp; (Item.АлкоКод == &quot;&quot; || Item.АлкоКод == SelectedProduct.АлкоКод) &amp;&amp; (ПоДатеРозлива==false || Item.ДатаРозлива == null || Item.ДатаРозлива.Ticks == 0 || Item.ДатаРозлива == SelectedProduct.ДатаРозлива))" errorQuantityMessage="" id="2ff74085-aa26-4bd9-a73a-c264a48ff567" ignoreFieldsInDocument="False" indent="2" name="Запись БЕЗ проверки Весовой" nextDirection="7" noProductErrorDirection="25" noProductInDocumentMessage="" onlyInCurrentItems="False" quantityErrorDirection="65" useSelectedLine="False"><ComparingFieldNames count="0" /><ComparingFieldNamesForCurrentItems capacity="16" count="15"><String>FirstStorageBarcode</String><String>Марка</String><String>КодСтроки</String><String>ИмяХарактеристики</String><String>СН</String><String>Цена</String><String>ЦенаПриемки</String><String>НомерСтрокиДокумента</String><String>ИдСерии</String><String>ИдХарактеристики</String><String>ИдЕдиницыИзмерения</String><String>АлкоСН</String><String>АлкоКод</String><String>ДатаРозлива</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><ConditionAction breakPoint="False" expression="Document.CreatedOnPDA != true &amp;&amp; Document.КонтрольЯчеек == True &amp;&amp; СтрокиДляСпускаВниз.Count != 0 &amp;&amp; СтрокиДляСпускаВниз[0].FirstStorageId != null &amp;&amp; FirstStorage != null" id="6f9cb3c0-586b-4f4c-9fa6-0c13dae36447" indent="2" name="ЕслиВыгруженаЯчейка 1" nextDirection="" noDirection="Запись с проверкой" yesDirection="Запись с проверкой и ячейкой" /><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="True" combineEqualCurrentItems="True" declaredExpression="(Item.Марка == SelectedProduct.Марка &amp;&amp; Item.Марка !=&quot;&quot; &amp;&amp; Item.Марка != null) || ((Document.CreatedOnPDA &amp;&amp; Item.Product.Маркировка == &quot;Табак&quot; &amp;&amp; Item.PackingId == SelectedProduct.PackingId)||((SelectedProduct.Product.Маркировка != &quot;Табак&quot; || Document.CreatedOnPDA == false) &amp;&amp; Item.ИдХарактеристики == SelectedProduct.ИдХарактеристики &amp;&amp; (Item.ИдСерии == &quot;&quot; || Item.ИдСерии == SelectedProduct.ИдСерии) &amp;&amp; (Item.АлкоКод == &quot;&quot; || Item.АлкоКод == SelectedProduct.АлкоКод) &amp;&amp; (ПоДатеРозлива==false || Item.ДатаРозлива == null || Item.ДатаРозлива == SelectedProduct.ДатаРозлива)))" errorQuantityMessage="" id="f82709c1-ca00-4945-9cf4-1fa7b2da3950" ignoreFieldsInDocument="False" indent="2" name="Запись с проверкой" nextDirection="7" noProductErrorDirection="25" noProductInDocumentMessage="" onlyInCurrentItems="False" quantityErrorDirection="65" useSelectedLine="False"><ComparingFieldNames count="0" /><ComparingFieldNamesForCurrentItems capacity="32" count="17"><String>FirstStorageBarcode</String><String>SSCC</String><String>Марка</String><String>КодСтроки</String><String>ИмяХарактеристики</String><String>СН</String><String>Цена</String><String>ЦенаПриемки</String><String>НомерСтрокиДокумента</String><String>ИдСерии</String><String>ИдХарактеристики</String><String>ИдЕдиницыИзмерения</String><String>ИдКоробки</String><String>АлкоСН</String><String>АлкоКод</String><String>ДатаРозлива</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="True" combineEqualCurrentItems="True" declaredExpression="(Item.Марка == SelectedProduct.Марка &amp;&amp; Item.Марка !=&quot;&quot; &amp;&amp; Item.Марка != null) || ((Document.CreatedOnPDA &amp;&amp; Item.Product.Маркировка == &quot;Табак&quot; &amp;&amp; Item.PackingId == SelectedProduct.PackingId)||((SelectedProduct.Product.Маркировка != &quot;Табак&quot; || Document.CreatedOnPDA == false) &amp;&amp; Item.ИдХарактеристики == SelectedProduct.ИдХарактеристики &amp;&amp; (Item.ИдСерии == &quot;&quot; || Item.ИдСерии == SelectedProduct.ИдСерии) &amp;&amp; Item.FirstStorageId==FirstStorage.Id &amp;&amp;  (Item.АлкоКод == &quot;&quot; || Item.АлкоКод == SelectedProduct.АлкоКод) &amp;&amp; (ПоДатеРозлива==false || Item.ДатаРозлива == null || Item.ДатаРозлива.Ticks == 0 || Item.ДатаРозлива == SelectedProduct.ДатаРозлива)))" errorQuantityMessage="" id="d3af0a3e-1ba1-497f-8591-7906cbc27730" ignoreFieldsInDocument="False" indent="2" name="Запись с проверкой и ячейкой" nextDirection="7" noProductErrorDirection="25" noProductInDocumentMessage="" onlyInCurrentItems="False" quantityErrorDirection="65" useSelectedLine="False"><ComparingFieldNames count="0" /><ComparingFieldNamesForCurrentItems capacity="32" count="17"><String>FirstStorageBarcode</String><String>SSCC</String><String>Марка</String><String>КодСтроки</String><String>ИмяХарактеристики</String><String>СН</String><String>Цена</String><String>ЦенаПриемки</String><String>НомерСтрокиДокумента</String><String>ИдСерии</String><String>ИдХарактеристики</String><String>ИдЕдиницыИзмерения</String><String>ИдКоробки</String><String>АлкоСН</String><String>АлкоКод</String><String>ДатаРозлива</String><String>АлкоПДФ</String></ComparingFieldNamesForCurrentItems></AcceptInDocumentAction><AssignAction breakPoint="False" comment="Если документ создан на терминале или работа без контроля кол-ва, то пишем последнюю отсканированную ячейку в план" expression="СтрокиТекущегоТовара = LastChangedDeclaredItems;&#xD;&#xA;ФактическиеДобавленныеСтроки = LastChangedCurrentItems;&#xD;&#xA;v = 0;&#xD;&#xA;while(v&lt;LastChangedCurrentItems.Count)&#xD;&#xA;{&#xD;&#xA;CurrentLine = LastChangedCurrentItems[v];&#xD;&#xA;if((Document.РаботаемСЯчейками == true&amp;&amp;CurrentLine.FirstStorageId!=&quot;&quot;&amp;&amp;CurrentLine.BindedLine.FirstStorageId== null)&#xD;&#xA;||(Document.CreatedOnPDA==true&amp;&amp;Document.РаботаемСЯчейками == true&amp;&amp;CurrentLine.FirstStorageId!=&quot;&quot;&amp;&amp;CurrentLine.BindedLine.FirstStorageId != CurrentLine.FirstStorageId))&#xD;&#xA;CurrentLine.BindedLine.FirstStorageId = CurrentLine.FirstStorageId;&#xD;&#xA;if(CurrentLine.SSCC!=null&amp;&amp;CurrentLine.BindedLine.SSCC != CurrentLine.SSCC)&#xD;&#xA;CurrentLine.BindedLine.SSCC = CurrentLine.SSCC;&#xD;&#xA;if(CurrentLine.ИдКоробки!=&quot;&quot;&amp;&amp;CurrentLine.BindedLine.ИдКоробки != CurrentLine.ИдКоробки)&#xD;&#xA;CurrentLine.BindedLine.ИдКоробки = CurrentLine.ИдКоробки;&#xD;&#xA;if(SelectedProduct.Product.ПоСериям == True &amp;&amp; LastChangedCurrentItems.Count!=0 &amp;&amp; LastChangedCurrentItems[0].ИдСерии!=&quot;&quot;&amp;&amp; LastChangedCurrentItems[0].BindedLine.ИмяСерии != LastChangedCurrentItems[0].ИмяСерии)&#xD;&#xA;LastChangedCurrentItems[0].BindedLine.ИмяСерии = LastChangedCurrentItems[0].ИмяСерии;&#xD;&#xA;v = v + 1;&#xD;&#xA;}" id="d332ced0-b4f8-47e4-b4e2-886be303d869" indent="0" name="7" nextDirection="" /><AssignAction breakPoint="False" expression="ФактическиеДобавленныеСтроки.ДатаПоследнегоИзменения = CurrentDate" id="3b8b6f2a-75e3-4cd9-a003-5fc3b8abff95" indent="0" nextDirection="" /><AssignAction breakPoint="False" comment="//Оптимизировано(21.12.2018)" expression="СтрокиПоказа = Document.DeclaredItems;&#xD;&#xA;СтрокиПлана = СтрокиПоказа;&#xD;&#xA;if(FirstStorage != null)&#xD;&#xA;{&#xD;&#xA;СтрокиПлана = СтрокиПоказа.FindByField(&quot;FirstStorageId&quot;,FirstStorage.Id);&#xD;&#xA;if(СтрокиПлана.Count == 0)&#xD;&#xA;СтрокиПлана = СтрокиПоказа.FindByField(&quot;FirstStorageId&quot;,null);&#xD;&#xA;}&#xD;&#xA;if(УдалятьСходящиеся == true)&#xD;&#xA;СтрокиПлана=СтрокиПлана.FindByUnderloadedOrOverloaded(true);&#xD;&#xA;if(СтрокиПлана.Count != 0)&#xD;&#xA;СтрокиПоказа = СтрокиПлана;&#xD;&#xA;else СтрокиПоказа = null;&#xD;&#xA;if(ШкПалеты != null)&#xD;&#xA;{&#xD;&#xA;СтрокиПлана = СтрокиПоказа.FindByField(&quot;SSCC&quot;,ШкПалеты);&#xD;&#xA;if(СтрокиПлана.Count != 0)&#xD;&#xA;СтрокиПоказа = СтрокиПлана;&#xD;&#xA;}&#xD;&#xA;if(ШкКоробки != null)&#xD;&#xA;{&#xD;&#xA;СтрокиПлана = СтрокиПоказа.FindByField(&quot;ИдКоробки&quot;,ШкКоробки);&#xD;&#xA;if(СтрокиПлана.Count == 0)&#xD;&#xA;СтрокиПоказа = СтрокиПлана;&#xD;&#xA;}" id="5bb9b27b-3336-444a-8455-c16e6812e1ca" indent="0" name="ОбновитьСтроки" nextDirection="" /><SelectDocumentLinesAction breakPoint="False" comment="//работает" id="19abe4d6-53e6-4315-9c7b-f1840e7f057c" indent="0" name="ПоискВЗаявке 1" nextDirection="ЕслиВыгрузкаПоЯчейкам" sessionVariable="СтрокиТекущегоТовара"><Query copySelection="False" documentLines="Declared" from="{Document.DeclaredItems}" sourceWhereExpression="" tableAlias="{Document.DeclaredItems}" useTableAliasForItem="False" whereCompiled="False" whereExpression="SelectedProduct.ProductId == Item.ProductId &amp;&amp; Item.ИмяХарактеристики==SelectedProduct.ИмяХарактеристики &amp;&amp; Item.ИмяСерии==SelectedProduct.ИмяСерии"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><ConditionAction breakPoint="False" expression="СтрокиТекущегоТовара.Count != 0 &amp;&amp; СтрокиТекущегоТовара[0].FirstStorageId != null &amp;&amp; FirstStorage != null" id="e692efd8-0e42-48e4-924f-b1b01d86ee48" indent="0" name="ЕслиВыгрузкаПоЯчейкам" nextDirection="" noDirection="ВыбратьСтрокиПоУпаковке" yesDirection="63" /><AssignAction breakPoint="False" expression="СтрокиПоЯчейке=СтрокиТекущегоТовара.FindByFirstCellIdWithCommon(FirstStorage.Id);&#xD;&#xA;if(СтрокиПоЯчейке.Count != 0)&#xD;&#xA;СтрокиТекущегоТовара = СтрокиПоЯчейке;" id="4b942f89-dbcd-46aa-8d0a-cdad5dfce247" indent="0" name="63" nextDirection="ВыбратьСтрокиПоУпаковке" /><AssignAction breakPoint="False" expression="if(СтрокиТекущегоТовара.Count != 0)&#xD;&#xA;строкиПоУпаковке = СтрокиТекущегоТовара.FindByField(&quot;PackingId&quot;, SelectedProduct.Packing.Id);&#xD;&#xA;else &#xD;&#xA;строкиПоУпаковке  = null;&#xD;&#xA;if(строкиПоУпаковке != null &amp;&amp; строкиПоУпаковке.Count != 0)&#xD;&#xA;СтрокиТекущегоТовара = строкиПоУпаковке;&#xD;&#xA;СтрокиДляСпускаВниз = СтрокиТекущегоТовара;" id="470950ca-8047-4a96-88d0-a1fb18ceadf7" indent="0" name="ВыбратьСтрокиПоУпаковке" nextDirection="64" /><ConditionAction breakPoint="False" expression="SelectedProduct.Алко == true &amp;&amp; Document.АлкоРежимСканироватьEAN13 == &quot;Не использовать&quot;" id="26f5ef98-0b72-4d3a-a177-5c4152edb7f5" indent="0" name="64" nextDirection="" noDirection="31" yesDirection="1" /><AssignAction breakPoint="False" comment="                //Для работы только по 417 тоже нужно поднятие строки" expression="SelectedLine = Document.DeclaredItems.FindFirstByField(&quot;АлкоКод&quot;,SelectedProduct.АлкоКод);&#xD;&#xA;if(SelectedLine != null)&#xD;&#xA;Document.DeclaredItems.TopBottom(SelectedLine,  true);&#xD;&#xA;SelectedItem = LastChangedDeclaredItems[0];" id="594a43ac-bb5b-4436-843a-58b29b798701" indent="0" name="1" nextDirection="return" /><ConditionAction breakPoint="False" expression="Document.ServerHosted!=true" id="a02b0ba0-a274-472f-8c81-8cf6eb31ad15" indent="0" name="31" nextDirection="" noDirection="return" yesDirection="" /><ConditionAction breakPoint="False" expression="СтрокиДляСпускаВниз!=null &amp;&amp; СтрокиДляСпускаВниз.Count&gt;0" id="98144ce5-d888-402a-aa3b-7e0476341e7a" indent="0" name="30 1" nextDirection="" noDirection="" yesDirection="Финал" /><AssignAction breakPoint="False" comment="                     //Поднятие для новых товаров" expression="СтрокиПоказа.TopBottom(LastChangedDeclaredItems[0],  true);&#xD;&#xA;SelectedItem = LastChangedDeclaredItems[0];" id="b65cffcc-7e86-44f2-b62b-3c348c498df0" indent="1" nextDirection="return" /><AssignAction breakPoint="False" expression="СтрокаДляСпуска = СтрокиПоказа.FindFirstByField(&quot;Закончен&quot;, true);&#xD;&#xA;if(СтрокаДляСпуска != null)&#xD;&#xA;СтрокиПоказа.TopBottom(СтрокаДляСпуска,  false);&#xD;&#xA;r=0;&#xD;&#xA;nc = СтрокиДляСпускаВниз.Count;&#xD;&#xA;while(r &lt; nc)&#xD;&#xA;{&#xD;&#xA; SelectedLine = СтрокиДляСпускаВниз[r];&#xD;&#xA; if(SelectedProduct.ЦенаПриемки &gt; 0)&#xD;&#xA;  SelectedLine.ЦенаПриемки = SelectedProduct.ЦенаПриемки;&#xD;&#xA; if(SelectedProduct.НомерСтрокиДокумента &gt; 0)&#xD;&#xA;  SelectedLine.НомерСтрокиДокумента = SelectedProduct.НомерСтрокиДокумента;&#xD;&#xA;if (УдалятьСходящиеся == false  &amp;&amp; SelectedLine.UnderloadedOrOverloaded == false &amp;&amp; SelectedLine.Закончен!=true)&#xD;&#xA;{&#xD;&#xA;SelectedLine.Закончен = true;&#xD;&#xA;СтрокиПоказа.TopBottom(SelectedLine,  true);&#xD;&#xA;}&#xD;&#xA; else&#xD;&#xA; СтрокиПоказа.TopBottom(SelectedLine,  true);&#xD;&#xA; r = r+1;&#xD;&#xA;}&#xD;&#xA;SelectedItem = LastChangedDeclaredItems[0];" id="b02bc426-6537-4f5a-8e87-c4249707997e" indent="0" name="Финал" nextDirection="" /><ConditionAction breakPoint="False" expression="УдалятьСходящиеся == true" id="2fe07286-23d2-4023-ac4f-210449052a65" indent="0" nextDirection="" noDirection="return" yesDirection="66" /><AssignAction breakPoint="False" expression="СтрокиПоказа = СтрокиПоказа.FindByUnderloadedOrOverloaded(true)" id="df401c0d-613f-415e-9a17-c405f2013f9c" indent="0" name="66" nextDirection="return" /><AssignAction breakPoint="False" expression="Перебор = true" id="a8264e85-8f0f-4fc8-ae0a-bc11b41b5bc3" indent="0" name="65" nextDirection="return" /><AssignAction breakPoint="False" expression="НетВПлане = true" id="ebfe561f-c0b8-4e5a-81fa-cc9dd390b529" indent="0" name="25" nextDirection="return" /></Actions><Parameters capacity="16" count="14"><FieldInfo alias="" eanAI="None" fieldName="SelectedProduct" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="SelectedProduct" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СтрокиДляСпускаВниз" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="StrokiDlyaSpuskaVniz" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="КонтрольТовараБезКолич" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="KontrolTovaraBezKolich" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СтрокиПоказа" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="StrokiPokaza" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="УдалятьСходящиеся" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="UdalyatShodyashhiesya" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ПоДатеРозлива" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="PoDateRozliva" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="НаборАлкоСерийныхНомеровЗавершен" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="NaborAlkoSerijnyhNomerovZavershen" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="Buffer" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="Buffer" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="FirstStorage" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="FirstStorage" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СтрокиТекущегоТовара" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="StrokiTekushhegoTovara" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ШкПаллеты" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ShkPallety" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ШкКоробки" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ShkKorobki" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СтрокиПлана" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="StrokiPlana" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ПоЯчейкам" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="PoYachejkam" valueTemplate="" /></Parameters><Returns capacity="16" count="9"><ReturnFieldInfo alias="" eanAI="None" fieldName="СтрокиТекущегоТовара" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="StrokiTekushhegoTovara" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ФактическиеДобавленныеСтроки" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="FakticheskieDobavlennyeStroki" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="Buffer" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="Buffer" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="СтрокиПоказа" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="StrokiPokaza" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ВШапку" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="VShapku" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="SelectedItem" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="SelectedItem" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="Перебор" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="Perebor" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="НетВПлане" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="NetVPlane" valueTemplate="" /><ReturnFieldInfo alias="" comment="не забыть удалить&#xD;&#xA;" eanAI="None" fieldName="СтрокиПлана" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="StrokiPlana" valueTemplate="" /></Returns></Operation>