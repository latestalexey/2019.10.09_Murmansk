<?xml version="1.0" encoding="utf-8"?><Operation xmlns:clr="http://schemas.cleverence.ru/clr" comment="ЕГАИС 3" fullscreen="Inherit" lock="No" name="ЕГАИС3 ВыборТовараПоАлкокоду" serverHosted="False"><Actions capacity="32" count="32"><OperationAction abortDirection="" breakPoint="False" id="1cfc9e65-db17-4625-9220-7c16844cf31a" indent="0" name="Проверить ПДФ" nextDirection="" operationName="ЕГАИС3 ПроверитьПДФ" transactionNotch="False"><InKeys count="0" /><InValues count="0" /><OutKeys count="3"><String>MSG</String><String>АлкоКод</String><String>АлкоПДФ</String></OutKeys><OutValues count="3"><String>{MSG}</String><String>{АлкоКод}</String><String>{АлкоПДФ}</String></OutValues></OperationAction><AssignAction breakPoint="False" expression="if (ИгратьОшибку == true)&#xD;&#xA;{GO.PlayError();}" id="70dc3572-624b-4152-89e5-18cc78037d3d" indent="0" nextDirection="" /><ConditionAction breakPoint="False" expression="MSG == null" id="9f19a5ef-139c-4c71-b7d9-d470aa7ced07" indent="0" name="если была ошибка" nextDirection="" noDirection="return" yesDirection="если режим с еаном" /><ConditionAction breakPoint="False" comment="Если &quot;Каждую бутылку&quot;, то всегда запрашивается EAN-13" expression="СессияРежимТовара == &quot;Каждую бутылку&quot;" id="aa95a151-7392-4fce-861c-924adb68cff6" indent="0" name="если режим с еаном" nextDirection="" noDirection="" yesDirection="очистка" /><ConditionAction breakPoint="False" comment="Если марка старого типа, то EAN-13 не нужен" expression="МаркаНовогоТипа == true" id="60c7b9d1-4948-4274-ba01-b7de5ac300b2" indent="0" nextDirection="" noDirection="4" yesDirection="" /><ConditionAction breakPoint="False" expression="СессияРежимТовара == &quot;Каждую коробку&quot;" id="cafe3afb-95cc-4b2c-9954-495cf1696e9c" indent="0" nextDirection="" noDirection="" yesDirection="151" /><AssignAction breakPoint="False" comment="Если режим товара &quot;Нет&quot;, то у марки нового типа выбирается продукт из плановой строки, а на ошибочные и новые запрашивается EAN-13" expression="МаркаВПлановыхСтроках = Document.DeclaredItems.FindFirstByField(&quot;АлкоПДФ&quot;, ScannedBarcode)" id="e0ce8598-fbf3-48ee-ab5b-23e14ce44442" indent="1" nextDirection="" /><ConditionAction breakPoint="False" comment="Марка есть в плановых строках?" expression="МаркаВПлановыхСтроках != null" id="8178212b-df0d-40ad-b030-e9d35dd41c28" indent="1" nextDirection="" noDirection="очистка" yesDirection="" /><ConditionAction breakPoint="False" comment="Проверяем статус марки нового типа" expression="ИдРодителя == МаркаВПлановыхСтроках.РодительПлан" id="fff1e1d4-0377-43e0-b755-60b9e7d313ac" indent="2" nextDirection="" noDirection="очистка" yesDirection="" /><AssignAction breakPoint="False" comment="Марка &quot;ОК&quot;, выбираем продукт из плановой строки" expression="SelectedProduct = МаркаВПлановыхСтроках.Product.Pack(МаркаВПлановыхСтроках.PackingId, 1);" id="a36f39a8-5483-446b-bdf0-93d8496b4654" indent="2" nextDirection="" /><ConditionAction breakPoint="False" comment="Удалось выбрать продукт из плановой строки?" expression="SelectedProduct == null" id="e9d1a17e-201c-467a-91ff-61fdcb254c35" indent="2" nextDirection="" noDirection="Проверка по коробу" yesDirection="очистка" /><ConditionAction breakPoint="False" comment="Изменилась серия или тип марки" expression="(ТекКорСерияМарки != &quot;&quot; &amp;&amp; ТекКорТипМарки != &quot;&quot;) &amp;&amp; (ТекКорСерияМарки != ScannedBarcode.Substring(3, 3) || ТекКорТипМарки != ScannedBarcode.Substring(0, 3))" id="52176fc6-f389-4a28-9fac-3135701e36ba" indent="0" name="151" nextDirection="" noDirection="" yesDirection="очистка" /><ConditionAction breakPoint="False" comment="У коробки уже есть EAN-13?" expression="ТекКорТоварШК != &quot;&quot;" id="4a78e3df-336a-4f6f-b416-d647c427ec1d" indent="0" name="150" nextDirection="" noDirection="очистка" yesDirection="" /><AssignAction breakPoint="False" expression="ScannedBarcode = ТекКорТоварШК" id="f9efc6da-f0eb-4128-897d-04d8fa1233df" indent="1" nextDirection="Скан шк товара" /><ClearSessionAction all="False" breakPoint="False" id="4b1d4b17-bfb5-40d8-b85c-33e4593b90dc" indent="0" name="очистка" nextDirection=""><KeyNames count="1"><String>ScannedBarcode</String></KeyNames></ClearSessionAction><FieldEditAction autoCloseTime="0" backgroundImage="" breakPoint="False" cancelType="None" comment="Выбрана марка, сканируем товар" eanAI="None" editType="Session" fieldName="ScannedBarcode" fieldType="String" format="" fullscreen="Inherit" headerText="&lt;b size=&quot;+2&quot; align=&quot;center&quot; color=&quot;Red&quot;&gt;{MSG}&lt;/b&gt;" id="b9f23bbf-ba61-40e7-b761-d43a28ba4aaa" indent="0" listItemFormat="" name="Выбрана марка, сканируем товар" nextDirection="" rememberPreviousValue="False" setForBuffer="False" showEditBox="True" showList="False" sizeType="Normal" transactionNotch="True" viewItems="" welcomeText="&lt;b size=&quot;+2&quot; color=&quot;black&quot;&gt;СКАНИРУЙТЕ&lt;/b&gt; &lt;b size=&quot;+2&quot; color=&quot;Red&quot;&gt;ШК ТОВАРА&lt;/b&gt;&#xD;&#xA;&lt;img tcolor=&quot;no&quot; size=&quot;stretch&quot; maxwidth=&quot;100%&quot; align=&quot;center&quot;&gt;egares.ean13&lt;/img&gt;"><Columns count="0" /><KeyJumps count="2"><KeyToAction action="abort" barcode="" condition="" foreColor="#00000000" key="Escape" modifiers="None" viewType="InMenu" /><KeyToAction action="Обработка ошибки" barcode="{any}" condition="" foreColor="#00000000" key="None" modifiers="None" viewType="InMenu" /></KeyJumps><Query copySelection="False" documentLines="Declared" sourceWhereExpression="" useTableAliasForItem="False" whereCompiled="False" whereExpression=""><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></FieldEditAction><OperationAction abortDirection="" breakPoint="False" id="e66838cf-3e1c-478f-bb81-74fae8180a66" indent="0" name="Обработка ошибки" nextDirection="" operationName="ЕГАИС3 ОбработкаОшибки" transactionNotch="False"><InKeys capacity="8" count="6"><String>ScannedBarcode</String><String>EAN13</String><String>PDF417</String><String>Pallet</String><String>Box</String><String>Product</String></InKeys><InValues capacity="8" count="6"><String>{ScannedBarcode}</String><String>True</String><String>False</String><String>False</String><String>False</String><String>True</String></InValues><OutKeys count="0" /><OutValues count="0" /></OperationAction><ConditionAction breakPoint="False" expression="Error==True" id="b1c23072-ca3b-4b5c-9e96-600db377461e" indent="0" name="была ли ошибка" nextDirection="" noDirection="" yesDirection="очистка 1" /><ScanAction autoCloseTime="0" autoSelectSingleProduct="True" autoShowSelectionList="True" backgroundImage="" barcodeConvertion="ToUpper" barcodeSessionVariable="ScannedBarcode" breakPoint="False" cancelType="None" canManualShowProductList="True" canSelectCell="False" canSelectPallet="False" cellDirection="" errorSelectDirection="товар не найден по ЕАН" footerText="" fullscreen="True" headerText="&#xD;&#xA;" id="454f2277-8b45-46ae-bd22-7e9ec279c5fd" ignoreBaseBarcodes="False" ignoreQuantityPolicy="False" indent="0" name="Скан шк товара" nextDirection="" notFoundErrorText="товар по артикулу или коду не найден" palletDirection="" playAudioOnError="True" processSessionBarcode="True" productsListHeaderText="" quickSelectProduct="False" searchingProducts="" searchPreviousSelected="False" selectionCellNum="0" selectionCellText="" selectionFirstCellText="" selectionListFormat="{Item.товВСпискеВыбора}" selectionPalletText="" selectionSecondCellText="" selectionStorageVariable="" sucsessSelectDirection="149" transactionNotch="False" useOnlyDocumentProducts="False" waitImage="" welcomeText="&lt;b color=&quot;black&quot; size=&quot;+2&quot; align=&quot;center&quot;&gt;СКАНИРУЙТЕ ШК ТОВАРА&lt;/b&gt;" withoutControls="False"><ExcludeClassificators count="0" /><IncludeClassificators count="0" /><KeyJumps count="1"><KeyToAction action="undo" barcode="" condition="" foreColor="#00000000" key="Escape" modifiers="None" viewType="InMenu" /></KeyJumps><TreeTypeIds count="0" /></ScanAction><OperationAction abortDirection="очистка 1" breakPoint="False" id="0648aa64-e19a-4151-aadb-22d00bde0322" indent="0" name="товар не найден по ЕАН" nextDirection="149" operationName="ЕГАИС3 Обработка неизвестного штрихкода" transactionNotch="False"><InKeys count="4"><String>ПриниматьНеизвШК</String><String>АлкоРежим</String><String>ПриниматьНеизвАлкокодКакНеизвТовар</String><String>НеВводитьОписаниеНеизвТовара</String></InKeys><InValues count="4"><String>true</String><String>true</String><String>false</String><String>true</String></InValues><OutKeys count="0" /><OutValues count="0" /></OperationAction><ClearSessionAction all="False" breakPoint="False" id="cddbd30d-869a-4d50-a2b7-998f8a22dbab" indent="1" name="очистка 1" nextDirection="Выбрана марка, сканируем товар"><KeyNames count="2"><String>ScannedBarcode</String><String>SelectedProduct</String></KeyNames></ClearSessionAction><ConditionAction breakPoint="False" expression="SelectedProduct == null" id="16c43b29-9ffc-4dba-bb80-34d8ac8e211f" indent="0" name="149" nextDirection="" noDirection="Проверка по коробу" yesDirection="очистка" /><ConditionAction breakPoint="False" expression="СессияВыборНоменклатурыВсегда == false &amp;&amp; ПрошлыйТовар != null &amp;&amp; ПрошлыйТовар.АлкоКод == АлкоКод" id="62a77bec-8a8f-431b-bde5-70fc6fd3c3e8" indent="0" name="4" nextDirection="" noDirection="3" yesDirection="7" /><ClearSessionAction all="False" breakPoint="False" id="15e3479a-0e70-4d4a-b9e3-6244cb1fd99c" indent="1" name="3" nextDirection=""><KeyNames count="1"><String>ПрошлыйТовар</String></KeyNames></ClearSessionAction><ScanAction autoCloseTime="0" autoSelectSingleProduct="False" autoShowSelectionList="False" backgroundImage="" barcodeConvertion="ToUpper" barcodeSessionVariable="АлкоКод" breakPoint="False" cancelType="None" canManualShowProductList="False" canSelectCell="False" canSelectPallet="False" cellDirection="" errorSelectDirection="товар не найден по алкокоду" fullscreen="Inherit" id="870e1981-292f-46dd-9126-e92532cbafab" ignoreBaseBarcodes="False" ignoreQuantityPolicy="False" indent="1" name="Поиск по ШК 1" nextDirection="" notFoundErrorText="" palletDirection="" playAudioOnError="False" processSessionBarcode="True" productsListHeaderText="" quickSelectProduct="False" searchingProducts="" searchPreviousSelected="False" selectionCellNum="0" selectionCellText="" selectionFirstCellText="" selectionListFormat="{Item.товВСпискеВыбора}" selectionPalletText="" selectionSecondCellText="" selectionStorageVariable="" sucsessSelectDirection="Проверка по коробу" transactionNotch="False" useOnlyDocumentProducts="False" waitImage="" welcomeText="" withoutControls="False"><ExcludeClassificators count="0" /><IncludeClassificators count="0" /><KeyJumps count="1"><KeyToAction action="28 1" barcode="" condition="" foreColor="#00000000" key="Escape" modifiers="None" viewType="InMenu" /></KeyJumps><TreeTypeIds count="0" /></ScanAction><OperationAction abortDirection="28 1" breakPoint="False" id="8165be05-aff0-4aaf-95fb-344dde731b5a" indent="1" name="товар не найден по алкокоду" nextDirection="Проверка по коробу" operationName="ЕГАИС3 Обработка неизвестного штрихкода" transactionNotch="False"><InKeys capacity="8" count="6"><String>ПриниматьНеизвШК</String><String>АлкоРежим</String><String>ПриниматьНеизвАлкокодКакНеизвТовар</String><String>НеВводитьОписаниеНеизвТовара</String><String>ScannedBarcode</String><String>ТекстАлкоКод</String></InKeys><InValues capacity="8" count="6"><String>true</String><String>true</String><String>false</String><String>true</String><String>{АлкоКод}</String><String>true</String></InValues><OutKeys count="0" /><OutValues count="0" /></OperationAction><AssignAction breakPoint="False" expression="SelectedProduct = ПрошлыйТовар" id="a4183652-f846-4959-99eb-15ba6730c333" indent="0" name="7" nextDirection="Проверка по коробу" /><ConditionAction breakPoint="False" expression="ТекущаяКоробка != null &amp;&amp; ТекКорТовар != &quot;&quot; &amp;&amp; ТекКорТовар != SelectedProduct.ProductId" id="dd26afc8-5ff1-4293-b164-85735d71e6ae" indent="0" name="Проверка по коробу" nextDirection="" noDirection="143" yesDirection="Коробка для другого товара" /><QuestionAction autoCloseTime="0" backgroundImage="" breakPoint="False" cancelType="None" comment="Коробка.Товар != Товар" defaultButtonHeight="0 px" fullscreen="Inherit" headerText="&lt;b size=&quot;+2&quot;&gt;Эта коробка для другого товара!&lt;/b&gt;" id="bcbe3f98-02c6-413a-9020-f983e5516203" indent="1" name="Коробка для другого товара" nextDirection="" showAsMsgBox="False" transactionNotch="True" welcomeText=""><ButtonDirections count="2"><String>6</String><String>28 1</String></ButtonDirections><ButtonTexts count="2"><String>Все равно принять</String><String>Отмена</String></ButtonTexts><KeyJumps count="1"><KeyToAction action="28 1" barcode="" condition="" foreColor="#00000000" key="Escape" modifiers="None" viewType="InMenu" /></KeyJumps></QuestionAction><AssignAction breakPoint="False" expression="НеСходитсяТовар = true" id="e27fec1f-5f7b-48fc-b95c-790ae688c699" indent="1" name="6" nextDirection="143" /><ClearSessionAction all="False" breakPoint="False" id="1ea41694-cc70-4de9-b0c3-e3677f7b673b" indent="1" name="28 1" nextDirection="abort"><KeyNames count="2"><String>ScannedBarcode</String><String>SelectedProduct</String></KeyNames></ClearSessionAction><AssignAction breakPoint="False" expression="SelectedProduct.АлкоКод = АлкоКод;&#xD;&#xA;SelectedProduct.АлкоПДФ = АлкоПДФ;&#xD;&#xA;SelectedProduct.Алко = true;&#xD;&#xA;ПрошлыйТовар = SelectedProduct;" id="4955eec8-0c9e-4803-a7e9-a8491b539ce1" indent="0" name="143" nextDirection="return" /></Actions><Parameters capacity="16" count="12"><FieldInfo alias="" eanAI="None" fieldName="ScannedBarcode" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ScannedBarcode" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ТекущаяКоробка" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="TekushhayaKorobka" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ПрошлыйТовар" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ProshlyjTovar" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="МаркаНовогоТипа" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="MarkaNovogoTipa" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СессияВыборНоменклатурыВсегда" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="SessiyaVyborNomenklaturyVsegda" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СессияРежимТовара" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="SessiyaRezhimTovara" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="АлкоКод" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="AlkoKod" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ТекКорТовар" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="TekKorTovar" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ТекКорТоварШК" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="TekKorTovarShK" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ИдРодителя" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="IdRoditelya" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ТекКорСерияМарки" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="TekKorSeriyaMarki" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ТекКорТипМарки" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="TekKorTipMarki" valueTemplate="" /></Parameters><Returns count="4"><ReturnFieldInfo alias="" eanAI="None" fieldName="SelectedProduct" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="SelectedProduct" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="MSG" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="MSG" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="НеСходитсяТовар" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="NeShoditsyaTovar" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ПрошлыйТовар" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="ProshlyjTovar" valueTemplate="" /></Returns></Operation>