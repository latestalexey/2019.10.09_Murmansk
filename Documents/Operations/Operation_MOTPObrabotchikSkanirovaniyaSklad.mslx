<?xml version="1.0" encoding="utf-8"?><Operation xmlns:clr="http://schemas.cleverence.ru/clr" comment="Выясняет, подходит ли штрихкод под табачную маркировку и возвращает заполненный SelectedProduct, если это возможно" fullscreen="Inherit" lock="No" name="МОТП ОбработчикСканированияСклад" serverHosted="False"><Actions capacity="64" count="35"><ConditionAction breakPoint="False" comment="Если это не пачка, то пытаемся парсить насильно" expression="ScannedBarcode.Length != 29" id="860aa140-9190-46ec-8df3-e7ab1a5a1eee" indent="0" nextDirection="" noDirection="1" yesDirection="26" /><AssignAction breakPoint="False" comment="Если это не пачка, то пытаемся парсить насильно" expression="времШК = global::Cleverence.Barcoding.Ean128.FormatAnyway(ScannedBarcode);&#xD;&#xA;if(времШК != &quot;&quot;) ScannedBarcode = времШК;" id="25a3587a-9d84-4d92-806a-30fd17b156f4" indent="1" name="26" nextDirection="" /><AssignAction breakPoint="False" comment="Поиск по шаблонам штрихкодов" expression="УпаковкаПоШтрихкоду = global::Cleverence.Warehouse.Compact.AdvancedOps.FindPallet(ScannedBarcode)" id="4eeedd70-debc-4e1f-bda6-b58bcb2913d6" indent="0" name="1" nextDirection="" /><ConditionAction breakPoint="False" comment="Упаковка или товар?" expression="УпаковкаПоШтрихкоду == null" id="db92f4c7-e324-42c3-8487-8659a89c3f82" indent="0" name="2" nextDirection="" noDirection="3" yesDirection="2 1" /><AssignAction breakPoint="False" comment="Это товар" expression="ЭтоКоробка = false;&#xD;&#xA;ЭтоПалета = false;&#xD;&#xA;ЭтоБлок = false;&#xD;&#xA;ЭтоПачка = true;" id="5570a94c-0236-4c2f-9759-6cc925e7700f" indent="1" name="2 1" nextDirection="" /><ConditionAction breakPoint="False" comment="Это пачка?" expression="ScannedBarcode.Length != 29" id="464c718c-cafe-4ed2-b01f-fa25d4ed9bae" indent="1" nextDirection="" noDirection="22" yesDirection="" /><AssignAction breakPoint="False" expression="ЭтоПачка = false" id="c36fc6cd-3fe1-4ead-9c7d-cdf795a5af60" indent="2" name="5 1 1 1 1" nextDirection="return" /><ConditionAction breakPoint="False" expression="ЗапрещенаПачка == true" id="5807319d-8033-4f78-bff0-856e370a4c37" indent="1" name="22" nextDirection="" noDirection="10" yesDirection="" /><AssignAction breakPoint="False" expression="GO.PlayError();&#xD;&#xA;ЭтоОшибка = true;&#xD;&#xA;Сообщение = &quot;Не нужно сканировать пачку!&quot;;" id="0244378a-fb88-400c-88ee-0563904631bd" indent="2" name="5 1 1 1" nextDirection="return" /><AssignAction breakPoint="False" comment="Это упаковка" expression="ЭтоКоробка = УпаковкаПоШтрихкоду.ЭтоКоробка;&#xD;&#xA;ЭтоПалета = УпаковкаПоШтрихкоду.ЭтоПалета;&#xD;&#xA;ЭтоБлок = УпаковкаПоШтрихкоду.ЭтоБлок;" id="683888a3-6b0c-4f52-9e40-4daf5fb2a334" indent="0" name="3" nextDirection="" /><ConditionAction breakPoint="False" expression="ЭтоПалета == true" id="dd73c7b1-09a0-4027-bc9f-d1a279be8624" indent="0" name="4" nextDirection="" noDirection="5" yesDirection="" /><ConditionAction breakPoint="False" expression="ЗапрещенаПалета == true" id="53bd62ce-c296-4392-97f8-bc86800aa082" indent="1" name="4 1" nextDirection="" noDirection="14" yesDirection="" /><AssignAction breakPoint="False" expression="GO.PlayError();&#xD;&#xA;ЭтоОшибка = true;&#xD;&#xA;Сообщение = &quot;Не нужно сканировать палету!&quot;;" id="fc1ce8f8-2a29-4a7c-8042-b7e6c1854f1f" indent="2" name="4 1 1" nextDirection="return" /><ConditionAction breakPoint="False" expression="ЭтоКоробка == true" id="086034ce-f218-4c1d-8b06-e890c27688bc" indent="0" name="5" nextDirection="" noDirection="6" yesDirection="" /><ConditionAction breakPoint="False" expression="ЗапрещенаКоробка == true" id="6539bd74-0d92-42e1-8726-1452f84e6dc2" indent="1" name="5 1" nextDirection="" noDirection="14" yesDirection="" /><AssignAction breakPoint="False" expression="GO.PlayError();&#xD;&#xA;ЭтоОшибка = true;&#xD;&#xA;Сообщение = &quot;Не нужно сканировать коробку!&quot;;" id="cd1c0025-27ba-411b-9fb3-1cae7a3deaf4" indent="2" name="5 1 1" nextDirection="return" /><ConditionAction breakPoint="False" expression="ЭтоБлок == true" id="60240224-ad8c-487d-8675-184aa7c85698" indent="0" name="6" nextDirection="" noDirection="11" yesDirection="" /><ConditionAction breakPoint="False" expression="ЗапрещенБлок == true" id="43735b5d-043b-4a2f-857f-08e02ed306c4" indent="1" name="6 1" nextDirection="" noDirection="14" yesDirection="" /><AssignAction breakPoint="False" expression="GO.PlayError();&#xD;&#xA;ЭтоОшибка = true;&#xD;&#xA;Сообщение = &quot;Не нужно сканировать блок!&quot;;" id="f19a9b75-cd56-4548-9578-67f2bc306ea2" indent="2" name="6 1 1" nextDirection="return" /><ConditionAction breakPoint="False" expression="УпаковкаПоШтрихкоду.ЭтоМикс == true" id="257deb3b-0c9f-4ba2-9eec-7be3d72cf63f" indent="0" name="14" nextDirection="" noDirection="16" yesDirection="" /><AssignAction breakPoint="False" comment="Это микс" expression="SelectedProduct = UnknownProduct.Pack();&#xD;&#xA;SelectedProduct.ЭтоМикс = true;" id="c2abc6b6-a0c2-4ede-a3f8-c2a5b7f45346" indent="2" nextDirection="17" /><AssignAction breakPoint="False" comment="Код товара, если это НЕ пачка" expression="КодТовара = УпаковкаПоШтрихкоду.КодТовара" id="ab9d41d8-12ce-4e49-8a1a-58bb88839b24" indent="1" name="16" nextDirection="8" /><AssignAction breakPoint="False" comment="Код товара, если это пачка" expression="КодТовара = ScannedBarcode.Substring(6,8);" id="3bead244-1906-4497-982a-0989a646e731" indent="0" name="10" nextDirection="" /><ScanAction autoCloseTime="0" autoSelectSingleProduct="True" autoShowSelectionList="False" backgroundImage="" barcodeConvertion="ToUpper" barcodeSessionVariable="КодТовара" breakPoint="False" cancelType="None" canManualShowProductList="True" canSelectCell="False" canSelectPallet="False" cellDirection="" comment="Поиск товара" errorSelectDirection="13" fullscreen="Inherit" id="86ad6dee-9111-4f08-b7ae-6b0f15cf89a6" ignoreBaseBarcodes="False" ignoreQuantityPolicy="False" indent="0" name="8" nextDirection="" notFoundErrorText="Товар не найден" palletDirection="" playAudioOnError="False" processSessionBarcode="True" productsListHeaderText="" quickSelectProduct="True" searchingProducts="" searchPreviousSelected="False" selectionCellNum="0" selectionCellText="" selectionFirstCellText="" selectionListFormat="" selectionPalletText="" selectionSecondCellText="" selectionStorageVariable="" sucsessSelectDirection="24" transactionNotch="True" useOnlyDocumentProducts="False" waitImage="" welcomeText="Выберите или отсканируйте товар" withoutControls="False"><ExcludeClassificators count="0" /><IncludeClassificators count="0" /><KeyJumps count="0" /><TreeTypeIds count="0" /></ScanAction><AssignAction breakPoint="False" comment="Товар не найден" expression="SelectedProduct = UnknownProduct.Pack();&#xD;&#xA;if (УпаковкаПоШтрихкоду.КоличествоВнутри != 0)&#xD;&#xA;{SelectedProduct.КоличествоВнутри = УпаковкаПоШтрихкоду.КоличествоВнутри;}" id="1a38c7b4-a494-4396-9add-106abb231e1c" indent="1" name="13" nextDirection="15" /><AssignAction breakPoint="False" expression="if (ЭтоБлок == true)&#xD;&#xA;{SelectedProduct.CurrentQuantity = 10;&#xD;&#xA;SelectedProduct.Сканировано = true;}" id="481e8d48-1424-4e8a-9a3a-f4c9274a80a0" indent="0" name="24" nextDirection="" /><ConditionAction breakPoint="False" comment="Упаковка или пачка?" expression="УпаковкаПоШтрихкоду != null" id="4f3552a5-4660-4a54-bebf-7afad96940a6" indent="0" name="15" nextDirection="" noDirection="12" yesDirection="" /><AssignAction breakPoint="False" comment="Это упаковка и товар найден" expression="SelectedProduct.СН = УпаковкаПоШтрихкоду.СерийныйНомер;&#xD;&#xA;SelectedProduct.Отображение = УпаковкаПоШтрихкоду.Отображение;&#xD;&#xA;if (УпаковкаПоШтрихкоду.КоличествоВнутри != 0)&#xD;&#xA;{SelectedProduct.КоличествоВнутри = УпаковкаПоШтрихкоду.КоличествоВнутри;}" id="14910256-45e4-43c3-8846-013ed411496b" indent="1" name="17" nextDirection="23" /><AssignAction breakPoint="False" comment="Это пачка и товар найден" expression="SelectedProduct.СН = ScannedBarcode.Substring(14, 7);&#xD;&#xA;Сканировано = true;" id="d4da0c85-d125-4b08-871c-07db57ebe3d2" indent="0" name="12" nextDirection="23" /><AssignAction breakPoint="False" comment="Эту ошибку должно быть невозможно воспроизвести, так как это не палета/коробка/блок/пачка/товар" expression="GO.PlayError();&#xD;&#xA;ЭтоОшибка = true;&#xD;&#xA;Сообщение = &quot;Штрихкод не распознан!&quot;;" id="dda166b6-b17c-4a1e-abc3-991c42079bec" indent="0" name="11" nextDirection="return" /><ConditionAction breakPoint="False" comment="Для списания на производстве" expression="ДляСписания == true &amp;&amp; (ЭтоПалета == true || ЭтоКоробка == true)" id="6fba2410-47b4-4a1e-ae71-62d6db581e15" indent="0" name="23" nextDirection="" noDirection="20" yesDirection="" /><QuestionAction autoCloseTime="0" backgroundImage="" breakPoint="False" cancelType="None" comment="Для списания на производстве" defaultButtonHeight="15%" footerText="&lt;button height=&quot;15%&quot; width=&quot;100%&quot; direction=&quot;abort&quot;&gt;Отмена&lt;/button&gt;" fullscreen="Inherit" id="fed6d87b-a2fb-462d-a291-ac87bdfdf87a" indent="1" name="18" nextDirection="" showAsMsgBox="False" transactionNotch="True" welcomeText="{ЭтоПалета == true:&lt;b&gt;Палета &lt;/b&gt;;{ЭтоКоробка == true:&lt;b&gt;Коробка &lt;/b&gt;;}}{УпаковкаПоШтрихкоду.Отображение:(0), }{УпаковкаПоШтрихкоду.ЭтоМикс == true:, смешанная;{SelectedProduct.Product == UnknownProduct:{УпаковкаПоШтрихкоду.КодТовара};{SelectedProduct.Product.Name}}}{УпаковкаПоШтрихкоду.КоличествоВнутри != null:, внутри &lt;b&gt;{УпаковкаПоШтрихкоду.КоличествоВнутри} {УпаковкаПоШтрихкоду.ЭтоПалета == true:кор.;бл.}&lt;/b&gt;;}&#xD;&#xA;&lt;h2&gt;{СписываемСканированием == true:&lt;Crimson&gt;Списать&lt;/Crimson&gt;;&lt;Green&gt;Оставить&lt;/Green&gt;} целиком?&lt;/h2&gt;"><ButtonDirections count="2"><String>25</String><String>19</String></ButtonDirections><ButtonTexts count="2"><String>Да, {СписываемСканированием == true:списать;оставить} целиком</String><String>Нет, {СписываемСканированием == true:списать;оставить} частично</String></ButtonTexts><KeyJumps count="1"><KeyToAction action="abort" barcode="" condition="" foreColor="#00000000" key="Escape" modifiers="None" viewType="InMenu" /></KeyJumps></QuestionAction><AssignAction breakPoint="False" comment="Для списания на производстве" expression="Частично = true" id="55aa49e8-4bec-4aad-a3a4-ea1ac1c7dd79" indent="1" name="19" nextDirection="" /><AssignAction breakPoint="False" comment="Для списания на производстве" expression="if (Document.СписываемСканированием == true)&#xD;&#xA;{SelectedProduct.Статус = &quot;Списать&quot;;}&#xD;&#xA;else&#xD;&#xA;{SelectedProduct.Статус = &quot;Оставить&quot;;}&#xD;&#xA;if (Частично == true)&#xD;&#xA;{SelectedProduct.Статус = SelectedProduct.Статус + &quot; частично&quot;;}" id="f189353b-7520-4c52-aa97-a049eea54c1f" indent="2" name="25" nextDirection="" /><AssignAction breakPoint="False" comment="Финальная общая часть для палет, коробок, блоков, пачек" expression="SelectedProduct.ЭтоПалета = ЭтоПалета;&#xD;&#xA;SelectedProduct.ЭтоКоробка = ЭтоКоробка;&#xD;&#xA;SelectedProduct.ЭтоБлок = ЭтоБлок;&#xD;&#xA;SelectedProduct.ЭтоПачка = ЭтоПачка;&#xD;&#xA;SelectedProduct.Марка = ScannedBarcode;&#xD;&#xA;SelectedProduct.КодТовара = КодТовара;&#xD;&#xA;SelectedProduct.МРЦ = УпаковкаПоШтрихкоду.МРЦ;&#xD;&#xA;SelectedProduct.Маркировка = &quot;Табак&quot;;" id="8d6f805f-bd0b-45ba-8b9d-a95142059003" indent="0" name="20" nextDirection="" /></Actions><Parameters capacity="8" count="7"><FieldInfo alias="" eanAI="None" fieldName="ScannedBarcode" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ScannedBarcode" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ЗапрещенаПалета" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ZapreshhenaPaleta" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ЗапрещенаКоробка" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ZapreshhenaKorobka" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ЗапрещенБлок" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ZapreshhenBlok" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ЗапрещенаПачка" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ZapreshhenaPachka" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СписываемСканированием" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="SpisyvaemSkanirovaniem" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ДляСписания" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="DlyaSpisaniya" valueTemplate="" /></Parameters><Returns capacity="16" count="9"><ReturnFieldInfo alias="" eanAI="None" fieldName="ЭтоКоробка" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="EtoKorobka" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ЭтоПалета" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="EtoPaleta" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ЭтоБлок" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="EtoBlok" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ЭтоПачка" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="EtoPachka" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ЭтоОшибка" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="EtoOshibka" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="Сообщение" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="Soobshhenie" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="SelectedProduct" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="SelectedProduct" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="УпаковкаПоШтрихкоду" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="UpakovkaPoShtrihkodu" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ScannedBarcode" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="ScannedBarcode" valueTemplate="" /></Returns></Operation>