<?xml version="1.0" encoding="utf-8"?><Operation xmlns:clr="http://schemas.cleverence.ru/clr" comment="ЕГАИС 3 | sh" fullscreen="Inherit" lock="AllOperations" name="ЕГАИС3 СтрокиКоробкиФильтрованные" serverHosted="True"><Actions capacity="16" count="13"><SelectDocumentLinesAction breakPoint="False" id="a2374f31-c7bb-4d15-8873-edc468b6b161" indent="0" nextDirection="" sessionVariable="СписокТоваров"><Query copySelection="False" documentLines="Declared" from="Document.Структура" sourceWhereExpression="" tableAlias="Document.Структура" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.Родитель == ИдРодителя"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><SelectDocumentLinesAction breakPoint="False" id="806cd487-bcaf-4ba9-add9-4ec975f85ded" indent="0" name="49" nextDirection="" sessionVariable="СписокКоробок"><Query copySelection="False" documentLines="Declared" from="Document.Коробки" sourceWhereExpression="" tableAlias="Document.Коробки" useTableAliasForItem="False" whereCompiled="False" whereExpression="(Item.РодительПлан == ИдРодителя &amp;&amp; Item.Статус == &quot;&quot;) || (Item.РодительФакт == ИдРодителя &amp;&amp; Item.Статус != &quot;&quot;)"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="2"><String>Статус DESC</String><String>Внутри ASC</String></SortBy><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><SelectDocumentLineAction breakPoint="False" id="fc3f62d5-b81d-421f-b209-d9d5398762e0" indent="0" nextDirection="" sessionVariable="ТекущаяКоробка"><Query copySelection="False" documentLines="Declared" from="Document.Коробки" sourceWhereExpression="" tableAlias="Document.Коробки" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.Ид == ИдРодителя"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLineAction><AssignAction breakPoint="False" expression="ТекКорТовар = ТекущаяКоробка.Товар;&#xD;&#xA;ТекКорТоварШК = ТекущаяКоробка.ТоварШК;&#xD;&#xA;ТекКорЭтоПалета = ТекущаяКоробка.ЭтоПалета;&#xD;&#xA;ТекКорСерияМарки = ТекущаяКоробка.СерияМарки;&#xD;&#xA;ТекКорТипМарки = ТекущаяКоробка.ТипМарки;&#xD;&#xA;ТекКорСерийныйНомерКоробки = ТекущаяКоробка.СерийныйНомерКоробки;" id="39562711-9a5a-4727-81eb-42471ec9bb0f" indent="1" nextDirection="" /><AssignAction breakPoint="False" comment="// Вынесено наружу, так как запрещено в серверной операции" expression="СтрокиПоказа = global::Cleverence.Warehouse.ObjectCollection.CreateServerHosted();&#xD;&#xA;СтрокиПоказа.AddRange(СписокТоваров);&#xD;&#xA;СтрокиПоказа.AddRange(СписокКоробок);" id="9705cd73-424f-4b76-9840-fa874fbc8392" indent="0" nextDirection="" /><AssignAction breakPoint="False" expression="СошлосьКоробок = СписокКоробок.FindByField(&quot;Статус&quot;, &quot;ок&quot;).FindByField(&quot;Внутри&quot;, &quot;ок&quot;).Count" id="a8636b94-c82e-4f6b-9415-b02056d5a29c" indent="0" nextDirection="" /><AssignAction breakPoint="False" expression="ВсегоКоробок = СписокКоробок.Count" id="b883524d-8b27-4614-91e4-d2ebbdd567a8" indent="0" nextDirection="" /><SelectDocumentLinesAction breakPoint="False" id="4c056c8f-81ea-4473-9ade-b340f5ef77b1" indent="0" nextDirection="" sessionVariable="СписокСтрок"><Query copySelection="False" documentLines="Current" sourceWhereExpression="" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.РодительФакт == ИдРодителя"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><AssignAction breakPoint="False" expression="СошлосьСтрок = СписокСтрок.FindByField(&quot;ПоПлануДаНет&quot;, true).Count" id="18591fd5-d793-4a5b-8c95-c75d1c4541d1" indent="0" nextDirection="" /><AssignAction breakPoint="False" expression="ПланСтрок = СписокТоваров.План" id="8c71b633-1053-4343-8a5e-af2e5073824c" indent="0" name="117" nextDirection="" /><ConditionAction breakPoint="False" expression="ИдРодителя != &quot;&quot;" id="5c8c096c-4843-47f6-958d-d8b7979be577" indent="0" nextDirection="" noDirection="" yesDirection="116" /><SelectDocumentLinesAction breakPoint="False" id="4b9faef0-b1db-42ae-aa8f-49baa24a4090" indent="0" nextDirection="" sessionVariable="КоробкиДляОшибок"><Query copySelection="False" documentLines="Declared" from="СписокКоробок" sourceWhereExpression="" tableAlias="СписокКоробок" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.Номенклатура == НоменклатураСтрока"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><OperationAction abortDirection="" breakPoint="False" id="57d6db4d-a8d6-408c-9703-c78e96542e29" indent="0" name="116" nextDirection="" operationName="ЕГАИС3 СчитаемКоличествоОшибок" transactionNotch="False"><InKeys count="2"><String>СписокВсехКоробок</String><String>ЛПШтучек</String></InKeys><InValues count="2"><String>{КоробкиДляОшибок}</String><String>{СписокСтрок}</String></InValues><OutKeys count="0" /><OutValues count="0" /></OperationAction></Actions><Parameters count="2"><FieldInfo alias="" eanAI="None" fieldName="ИдРодителя" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="IdRoditelya" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="НоменклатураСтрока" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="NomenklaturaStroka" valueTemplate="" /></Parameters><Returns capacity="32" count="18"><ReturnFieldInfo alias="" eanAI="None" fieldName="СписокКоробок" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="SpisokKorobok" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="СписокТоваров" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="SpisokTovarov" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="СошлосьКоробок" fieldType="Int32" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="SoshlosKorobok" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ВсегоКоробок" fieldType="Int32" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="VsegoKorobok" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="СошлосьСтрок" fieldType="Int32" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="SoshlosStrok" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ПланСтрок" fieldType="Int32" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="PlanStrok" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="КоличествоОшибок" fieldType="Int32" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="KolichestvoOshibok" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ТекущаяКоробка" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="TekushhayaKorobka" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="МожноЗакрывать" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="MozhnoZakryvat" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="КоробкиДляОшибок" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="KorobkiDlyaOshibok" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="СписокСтрок" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="SpisokStrok" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="СтрокиПоказа" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="StrokiPokaza" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ТекКорТовар" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="TekKorTovar" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ТекКорЭтоПалета" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="TekKorEtoPaleta" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ТекКорСерияМарки" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="TekKorSeriyaMarki" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ТекКорТипМарки" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="TekKorTipMarki" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ТекКорСерийныйНомерКорбки" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="TekKorSerijnyjNomerKorbki" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ТекКорТоварШК" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="TekKorTovarShK" valueTemplate="" /></Returns></Operation>