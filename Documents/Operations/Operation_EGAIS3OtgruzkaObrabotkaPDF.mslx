<?xml version="1.0" encoding="utf-8"?><Operation xmlns:clr="http://schemas.cleverence.ru/clr" comment="ЕГАИС 3 | sh | Обработка бутылки" fullscreen="Inherit" lock="AllOperations" name="ЕГАИС3 ОтгрузкаОбработкаПДФ" serverHosted="True"><Actions capacity="32" count="20"><AssignAction breakPoint="False" comment="Уже была?" expression="УжеБылТакойПДФ = Document.CurrentItems.FindFirstByField(&quot;АлкоПДФ&quot;, ScannedBarcode)" id="85dc3d5f-de9c-48fd-b47f-e892f06dec4f" indent="0" nextDirection="" /><ConditionAction breakPoint="False" comment="Уже была?" expression="УжеБылТакойПДФ != null" id="d181ac14-eb9b-4958-84cc-48f3f5b09c3d" indent="0" nextDirection="" noDirection="13" yesDirection="" /><AssignAction breakPoint="False" expression="ПовторМарка = true" id="0e715dab-6dd3-4085-8b09-146fe031fccd" indent="1" nextDirection="return" /><SelectDocumentLineAction breakPoint="False" comment="(deprecated)" id="4888ecf7-b0d3-4611-a283-75018000f54a" indent="0" name="7" nextDirection="3 1 1" sessionVariable="ЕстьВТаблице"><Query copySelection="False" documentLines="Declared" from="{БутылкиЕГАИС}" sourceWhereExpression="" tableAlias="{БутылкиЕГАИС}" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.АлкоПДФ == ScannedBarcode"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLineAction><AssignAction breakPoint="False" expression="ЕстьВТаблице = БутылкиЕГАИС.FindFirstByField(&quot;АлкоПДФ&quot;, ScannedBarcode)" id="bd3e5158-5541-4514-8040-41d6ce0d2df7" indent="0" name="13" nextDirection="" /><SelectDocumentLineAction breakPoint="False" comment="Смотрим факт" id="e21e4551-efd5-4187-b4a6-db29b715ab84" indent="0" name="3 1 1" nextDirection="" sessionVariable="ПроверкаУжеЕстьВКоробкеФакт"><Query copySelection="False" documentLines="Declared" from="{Document.КоробкиФакт}" sourceWhereExpression="" tableAlias="{Document.КоробкиФакт}" useTableAliasForItem="False" whereCompiled="False" whereExpression="Item.Количество &gt; 0 &amp;&amp; Item.Коробка == ЕстьВТаблице.Коробка"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLineAction><ConditionAction breakPoint="False" comment="Смотрим факт" expression="ПроверкаУжеЕстьВКоробкеФакт != null" id="7265063e-8929-461d-a963-638c3582fc44" indent="0" nextDirection="" noDirection="9" yesDirection="" /><AssignAction breakPoint="False" comment="Смотрим факт" expression="MSG = &quot;Коробка с этой бутылкой уже была добавлена в документ&quot;;&#xD;&#xA;ИгратьОшибку = true;" id="699a79a6-7990-4c56-8e01-ca64cf272405" indent="1" name="2 1 1 1" nextDirection="return" /><ConditionAction breakPoint="False" comment="Смотрим таблицу" expression="ЕстьВТаблице != null" id="e882b9a9-5aa8-42bb-9cbb-3dec5f2a9759" indent="0" name="9" nextDirection="" noDirection="2" yesDirection="10" /><AssignAction breakPoint="False" comment="Смотрим таблицу" expression="MSG = &quot;Бутылка не найдена в таблицах остатков&quot;;&#xD;&#xA;ИгратьОшибку = true;" id="3d501dcb-e850-4b31-860d-a3af7e5e0a0a" indent="1" name="2" nextDirection="return" /><SelectDocumentLinesAction breakPoint="False" comment="Смотрим план" id="fe898f52-6046-4430-b3bc-e8cc2c6e09a8" indent="0" name="10" nextDirection="" sessionVariable="ПланСтроки"><Query copySelection="False" documentLines="Declared" sourceWhereExpression="" useTableAliasForItem="False" whereCompiled="False" whereExpression="(Item.ProductId == &quot;&quot; || Item.ProductId == ЕстьВТаблице.КодНоменклатуры) &amp;&amp; (Item.АлкоКод == &quot;&quot; || Item.АлкоКод == ЕстьВТаблице.АлкоКод) &amp;&amp; (Item.АлкоНаим == &quot;&quot; || Item.АлкоНаим == ЕстьВТаблице.АлкоНаим) &amp;&amp; (Item.СкладСерия == &quot;&quot; || Item.СкладСерия == ЕстьВТаблице.СкладСерия)"><Fields count="0" /><GroupBy count="0" /><QueryParameters count="0" /><SortBy count="0" /><Where count="0" /><WhereRootElement>null</WhereRootElement></Query></SelectDocumentLinesAction><ConditionAction breakPoint="False" comment="Смотрим план" expression="ПланСтроки.Count == 0" id="7030408c-f65f-457a-9d92-2e64e9d7eec5" indent="0" nextDirection="" noDirection="8" yesDirection="" /><AssignAction breakPoint="False" comment="Смотрим план" expression="MSG =&quot;Бутылка найдена, но не подходит по заданию&quot;;&#xD;&#xA;ИгратьОшибку = true;" id="f1897849-c460-4928-82b7-0df62a3ed2d2" indent="1" name="12" nextDirection="return" /><ConditionAction breakPoint="False" comment="Смотрим план" expression="ПланСтроки.Count != 1" id="a90c4bbe-8137-4608-abab-f76651f4b887" indent="0" name="8" nextDirection="" noDirection="11" yesDirection="" /><ForeachAction breakPoint="False" buttonExit="True" canFinishAlways="False" comment="Смотрим план" cyclic="True" exitButtonText="Закончить набор" exitGroupCode="" fullscreen="Inherit" id="66b8dd94-b974-4773-a62b-7b3787dd2f9a" indent="1" items="{ПланСтроки}" nextDirection="12" transactionNotch="False"><Actions count="2"><ConditionAction breakPoint="False" expression="SelectedLine.CurrentQuantity &lt; SelectedLine.DeclaredQuantity" id="1e793d76-40a0-44ca-a501-f0b5aedd5d32" indent="0" name="1 2 1" nextDirection="" noDirection="continue" yesDirection="" /><AssignAction breakPoint="False" expression="ПланСтрока = SelectedLine" id="8cdade1a-7ee9-4cbf-b79a-9b53415d12c0" indent="1" name="1" nextDirection="up:4" /></Actions><LockObjects count="0" /></ForeachAction><AssignAction breakPoint="False" expression="ПланСтрока = ПланСтроки[0]" id="ecb11bc6-98a3-4a80-8a17-64acc1f54df7" indent="0" name="11" nextDirection="" /><ConditionAction breakPoint="False" comment="Превышение?" expression="ПланСтрока.CurrentQuantity &lt; ПланСтрока.DeclaredQuantity" id="5097086d-7064-475e-84fa-e2bc47d1aeec" indent="0" name="1 2" nextDirection="" noDirection="38 1 1" yesDirection="4" /><OperationAction abortDirection="" breakPoint="False" id="145df40e-9a63-4cf7-b661-4bd5fef9bdd4" indent="1" name="4" nextDirection="5" operationName="ЕГАИС3 ОтгрузкаЗапись" transactionNotch="False"><InKeys count="0" /><InValues count="0" /><OutKeys count="0" /><OutValues count="0" /></OperationAction><AssignAction breakPoint="False" expression="ДобавленаБутылка = true;" id="9a3acc60-9dc3-4929-9d78-928222a98f5f" indent="1" name="5" nextDirection="return" /><AssignAction breakPoint="False" expression="MSG = &quot;Превышение количества&quot;;&#xD;&#xA;ИгратьОшибку = true;" id="0962dd1f-d1d4-44dd-9dae-f071c3b375cb" indent="0" name="38 1 1" nextDirection="return" /></Actions><Parameters count="4"><FieldInfo alias="" eanAI="None" fieldName="ScannedBarcode" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="ScannedBarcode" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ТекущаяКоробка" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="TekushhayaKorobka" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СессияКоробкиПодбора" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="SessiyaKorobkiPodbora" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ТекущийПользователь" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="TekushhijPolzovatel" valueTemplate="" /></Parameters><Returns capacity="8" count="7"><ReturnFieldInfo alias="" eanAI="None" fieldName="ИгратьОшибку" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="IgratOshibku" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="MSG" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="MSG" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ДобавленаБутылка" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="DobavlenaButylka" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ЕстьВТаблице" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="EstVTablice" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ПланСтрока" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="PlanStroka" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ПовторМарка" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="PovtorMarka" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="УжеБылТакойПДФ" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="UzheBylTakojPDF" valueTemplate="" /></Returns></Operation>