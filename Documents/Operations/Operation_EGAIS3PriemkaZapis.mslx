<?xml version="1.0" encoding="utf-8"?><Operation xmlns:clr="http://schemas.cleverence.ru/clr" comment="ЕГАИС 3 | sh" fullscreen="Inherit" lock="AllOperations" name="ЕГАИС3 ПриемкаЗапись" serverHosted="True"><Actions capacity="32" count="21"><AssignAction breakPoint="False" expression="SelectedProduct.РодительФакт = ИдРодителя;&#xD;&#xA;if (ИдРодителя != null)&#xD;&#xA;{ТекущаяКоробка = Document.Коробки.FindFirstByField(&quot;Ид&quot;, ИдРодителя);}" id="db664d8b-768e-43d6-8f91-46242762e046" indent="0" nextDirection="" /><ConditionAction breakPoint="False" expression="Document.CreatedOnPDA == true" id="11944d79-5050-4655-8c7b-485fafcaa764" indent="0" nextDirection="" noDirection="" yesDirection="22" /><AssignAction breakPoint="False" expression="ПоискЛППоПлану = Document.DeclaredItems.FindFirstByField(&quot;АлкоПДФ&quot;, SelectedProduct.АлкоПДФ)" id="9b0fbe92-85e6-462f-9b84-27ba6db3f8fc" indent="1" nextDirection="" /><ConditionAction breakPoint="False" expression="ПоискЛППоПлану == null" id="eb7c6354-f356-4d96-8ade-d92de83b012c" indent="1" nextDirection="" noDirection="17" yesDirection="" /><AssignAction breakPoint="False" expression="SelectedProduct.ПоПлану = &quot;новая&quot;;&#xD;&#xA;SelectedProduct.ПоПлануДаНет = false;&#xD;&#xA;ИгратьОшибку = true;" id="0be8f4fd-0ee5-4fe9-930e-a5c28641b858" indent="2" name="15" nextDirection="20" /><ConditionAction breakPoint="False" expression="НеСходитсяТовар == true || ПоискЛППоПлану.ProductId != SelectedProduct.ProductId" id="f2477f8a-0436-4fc5-8459-f03f321f27dd" indent="2" name="17" nextDirection="" noDirection="10" yesDirection="" /><AssignAction breakPoint="False" expression="SelectedProduct.ПоПлану = &quot;другаяупаковка&quot;;&#xD;&#xA;SelectedProduct.ПоПлануДаНет = false;&#xD;&#xA;ИгратьОшибку = true;" id="9f69d6f3-2caf-4638-8dd4-8702fa66f5cb" indent="3" name="8 1" nextDirection="19" /><ConditionAction breakPoint="False" expression="ПоискЛППоПлану.РодительПлан == SelectedProduct.РодительФакт" id="1fa29cd0-5b70-49a5-94e0-11398496b152" indent="2" name="10" nextDirection="" noDirection="8" yesDirection="9" /><AssignAction breakPoint="False" expression="SelectedProduct.ПоПлану = &quot;ненаместе&quot;;&#xD;&#xA;SelectedProduct.ПоПлануДаНет = false;&#xD;&#xA;ИгратьОшибку = true;" id="9270c0b3-5121-4dd7-89a1-ba72d8e3edd5" indent="3" name="8" nextDirection="18" /><AssignAction breakPoint="False" expression="SelectedProduct.ПоПлану = &quot;ок&quot;;&#xD;&#xA;SelectedProduct.ПоПлануДаНет = true;" id="d471f691-7c45-4e71-97c2-aed31d73b81e" indent="3" name="9" nextDirection="22" /><AssignAction breakPoint="False" expression="MSG=&quot;Бутылка не на месте!&quot;" id="89decf8c-189e-4c3f-b4b8-54871e8c207a" indent="2" name="18" nextDirection="22" /><AssignAction breakPoint="False" expression="MSG=&quot;Марка совпадает, но бутылка другой номенклатуры!&quot;" id="7ee4129a-9a13-4ef8-88e2-c2f34ee4f6aa" indent="2" name="19" nextDirection="22" /><AssignAction breakPoint="False" expression="MSG=&quot;Бутылки нет в плане!&quot;" id="15258ad3-0f2a-41e5-bf9f-5e6ee8f8f0ab" indent="2" name="20" nextDirection="" /><ConditionAction breakPoint="False" expression="(SelectedProduct.АлкоПДФ.Length == 150 || SelectedProduct.АлкоПДФ.Length == 151) &amp;&amp; ИдРодителя != &quot;&quot; &amp;&amp; СессияРежимТовара == &quot;Каждую коробку&quot; &amp;&amp; ТекущаяКоробка.СерияМарки == &quot;&quot;" id="70849eaf-7b42-4f4e-8c38-e69aa6dc28fb" indent="0" name="22" nextDirection="" noDirection="21" yesDirection="" /><AssignAction breakPoint="False" expression="ТекущаяКоробка.ТипМарки = SelectedProduct.АлкоПДФ.Substring(0, 3);&#xD;&#xA;ТекущаяКоробка.СерияМарки = SelectedProduct.АлкоПДФ.Substring(3, 3);&#xD;&#xA;НадоПерестроить = true;" id="8ba3b4db-1505-4429-a178-fa0a0da2eabe" indent="1" nextDirection="" /><AssignAction breakPoint="False" expression="SelectedProduct.ЗанесениеПользовательИд = ТекущийПользователь;&#xD;&#xA;SelectedProduct.ЗанесениеДата = CurrentDate;" id="c0191500-1a99-4135-856c-efb070a6773a" indent="0" name="21" nextDirection="" /><AcceptInDocumentAction breakPoint="False" checkDocumentInfill="False" checkQuantity="False" combineEqualCurrentItems="False" declaredExpression="" errorQuantityMessage="Товара больше, чем разрешает документ." id="d0081373-ade8-4ca3-912c-8cdc8a20a2b9" ignoreFieldsInDocument="False" indent="0" name="6" nextDirection="14" noProductErrorDirection="" noProductInDocumentMessage="Такой товар отсутствует в документе." onlyInCurrentItems="True" quantityErrorDirection="" useSelectedLine="False"><ComparingFieldNames count="1"><String>АлкоПДФ</String></ComparingFieldNames><ComparingFieldNamesForCurrentItems count="0" /></AcceptInDocumentAction><AssignAction breakPoint="False" comment="// пропущено" expression="LastChangedCurrentItems[0].BindedLine.РодительФакт = ИдРодителя;&#xD;&#xA;LastChangedCurrentItems[0].BindedLine.ПоПлану = SelectedProduct.ПоПлану;&#xD;&#xA;LastChangedCurrentItems[0].BindedLine.ПоПлануДаНет = SelectedProduct.ПоПлануДаНет;" id="7471928f-1241-49f2-95d5-4a38fca154c0" indent="0" nextDirection="" /><AssignAction breakPoint="False" comment="Возвращаем при успешной записи" expression="ЗаписьУспех = true" id="edcf75e1-fbf2-4dde-b845-baf463400d2c" indent="0" name="14" nextDirection="" /><AssignAction breakPoint="False" expression="Добавлено = LastChangedCurrentItems[0].Clone();" id="bd75ad72-5db2-4e05-ad2a-d74de47cc087" indent="0" name="13" nextDirection="" /><GroupAction breakPoint="False" buttonExit="True" canFinishAlways="False" cyclic="False" exitButtonText="Закончить набор" exitGroupCode="" fullscreen="Inherit" id="52a863df-5b34-4b47-9177-be9845b691d5" indent="0" nextDirection="" transactionNotch="False"><Actions capacity="8" count="7"><AssignAction breakPoint="False" expression="НаходимСтроку = СписокТоваров.FindFirstByField(&quot;ТоварИд&quot;, Добавлено.ProductId);" id="e8582af1-0a65-43a1-9dd4-2a1ee82cfbdf" indent="0" name="1" nextDirection="" /><ConditionAction breakPoint="False" expression="НаходимСтроку != null" id="6e90c2ba-fe79-4f18-91fd-396b92a84dce" indent="0" nextDirection="" noDirection="52 1" yesDirection="" /><AssignAction breakPoint="False" expression="НаходимСтроку.Факт = НаходимСтроку.Факт + 1;" id="95f93f14-aaf5-4b64-ab34-4b88e652de61" indent="1" nextDirection="" /><ConditionAction breakPoint="False" expression="Document.ServerHosted != true &amp;&amp; НадоПерестроить != true" id="96554eb6-c171-473b-baff-fe5fc5cad874" indent="1" nextDirection="" noDirection="return" yesDirection="" /><AssignAction breakPoint="False" expression="Обновили = true" id="600e8e34-9507-41ae-afd8-ce90c4b0a7a1" indent="1" nextDirection="" /><OperationAction abortDirection="return" breakPoint="False" id="766122a5-d05f-4101-8430-8f1a1b06ce59" indent="1" nextDirection="return" operationName="ЕГАИС3 ПоднимаемСтроку" transactionNotch="False"><InKeys count="1"><String>Строка</String></InKeys><InValues count="1"><String>{НаходимСтроку}</String></InValues><OutKeys count="0" /><OutValues count="0" /></OperationAction><AssignAction breakPoint="False" expression="НовСтрока = new Cleverence.Warehouse.Row();&#xD;&#xA;НовСтрока.Родитель = Добавлено.РодительФакт;&#xD;&#xA;НовСтрока.ПолноеИмя = Добавлено.Product.Name;&#xD;&#xA;НовСтрока.УпаковкаИд = Добавлено.PackingId;&#xD;&#xA;НовСтрока.ТоварИд = Добавлено.ProductId;&#xD;&#xA;НовСтрока.Факт = Добавлено.CurrentQuantity;&#xD;&#xA;НовСтрока.План = 0;&#xD;&#xA;Document.Структура.Rows.Add(НовСтрока);" id="f0b3974d-d5ea-4647-b746-5345034b7b1a" indent="0" name="52 1" nextDirection="return" /></Actions><LockObjects count="0" /></GroupAction></Actions><Parameters capacity="8" count="7"><FieldInfo alias="" eanAI="None" fieldName="SelectedProduct" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="SelectedProduct" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ИдРодителя" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="IdRoditelya" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СписокТоваров" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="SpisokTovarov" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="НеСходитсяТовар" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="NeShoditsyaTovar" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СтрокиПоказа" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="StrokiPokaza" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="ТекущийПользователь" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="TekushhijPolzovatel" valueTemplate="" /><FieldInfo alias="" eanAI="None" fieldName="СессияРежимТовара" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" uni="SessiyaRezhimTovara" valueTemplate="" /></Parameters><Returns capacity="8" count="8"><ReturnFieldInfo alias="" eanAI="None" fieldName="ТекущаяКоробка" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="TekushhayaKorobka" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="Добавлено" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="Dobavleno" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ЗаписьУспех" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="ZapisUspeh" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="MSG" fieldType="String" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="False" uni="MSG" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="Обновили" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="Obnovili" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="ИгратьОшибку" fieldType="Boolean" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="IgratOshibku" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="SelectedProduct" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="SelectedProduct" valueTemplate="" /><ReturnFieldInfo alias="" eanAI="None" fieldName="СписокТоваров" fieldType="Object" isSQLIndex="False" isSQLKeyIndex="False" isSQLSubstringIndex="False" oneTimeTemplateExecution="False" returnNull="True" uni="SpisokTovarov" valueTemplate="" /></Returns></Operation>